# BTB Semantic
```json
{
    "local_user1_DeviceControl": [
        [
            "Operation result: Success. Evidence: ''st':'mainSwitch','data':{'on':1}'. Reason: Successful state changes confirmed via MQTT deviceDataChanged notifications (specifically mainSwitch activation to ON state) without error indicators, consistent with control command execution."
        ]
    ],
    "local_user1_InviteAndAccept": [
        [
            ""
        ],
        [
            ""
        ],
        [
            "Operation result: Success. Evidence: '200'. Reason: Member invitation succeeded based on consistent HTTP 200 responses at the addition endpoint (/member/byaccount). A user lookup error (code 907134773) occurred during preliminary validation but didn't impact the final invitation outcome."
        ],
        [
            "Operation result: Failed. Evidence: ''error_code':205002'. Reason: Explicit error code 205002 confirms membership addition failure due to existing member. An initial user query error (code 907134773) preceded this failure but didn't alter the core duplicate membership verdict."
        ]
    ],
    "local_user1_RemoveDevice": [
        [
            "Operation result: Success. Evidence: 'notifyType:'deviceDeleted''. Reason: Deletion confirmed by MQTT notification (notifyType: deviceDeleted) with contextual alignment to HTTP DELETE operation intent."
        ]
    ],
    "local_user1_RemoveFromHome": [
        [
            ""
        ],
        [
            "Operation result: Success. Evidence: 'DELETE'; 'member'; '200'. Reason: Successful removal operation confirmed by HTTP DELETE request to member endpoint returning 200 status consistent across reports."
        ]
    ],
    "local_user2_DeviceControl": [
        [
            "Operation result: Undetermined. Evidence: ''. Reason: State change notifications observed but no command initiation packets detected, preventing execution confirmation."
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            "Operation result: Undetermined. Evidence: ''. Reason: State notifications confirmed status changes, but command packets lacked temporal or linkage correlation with control operations."
        ]
    ],
    "remote_user1_DeviceControl": [
        [
            "Operation result: Success. Evidence: '''errcode':0''; ''errcode':0'. Reason: Explicit success status (errcode:0) in MQTT command responses confirms successful device control execution, with response payloads consistently indicating error-free operation."
        ]
    ],
    "remote_user2_DeviceControl": [
        [
            "Operation result: Success. Evidence: 'errcode:0'. Reason: Control operation succeeded due to response status: errcode:0"
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            "Operation result: Failed. Evidence: 'errcode:500000401'. Reason: Control operation failed due to response status: errcode:500000401"
        ],
        [
            "Operation result: Failed. Evidence: 'errcode:500000404'. Reason: Control operation failed due to response status: errcode:500000404"
        ]
    ]
}
```

# State Semantic
## Base model

| State | Semantic Description |
|-------|----------------------|
| 0 | Initial state. |
| 1 | Error state. |
| 2 | user1 added the device once. user2 is not a family member and has no control permissions. |
| 3 | user1 added the device once. user2 is a family member with permanent control permissions. |
| 4 | user1 has not added the device. user2 is a family member with permanent control permissions, but the device is absent. |

## Divergent model
| State | Semantic Description |
|-------|----------------------|
| 0 | Initial state: user1 has not added any device; user2 is not a family member and has no permissions. |
| 1 | user1 added the device once (present); user2 is not a family member and has no control permissions. |
| 2 | Error state. |
| 3 | user1 has not added any device; user2 is a family member and will gain control permissions on any future devices added by user1. |
| 4 | user1 added the device once (present); user2 is a family member with control permissions. |
| 5 | user1 added the device once (present); user2 is a family member with control permissions. |
| 6 | user1 removed the device (absent); user2 remains a family member and retains control permissions for any re-added devices. |
| 7 | user1 has the device present; user2 is not a family member and has no control permissions after revocation. |
| 8 | user1 removed the device (absent) and revoked user2's family membership; user2 has no permissions. |
| 9 | user1 re-added the device (second instance present); user2 is not a family member and has no permissions after revocation. |
| 10 | user1 re-added the device (second instance present); user2 remains a family member with control permissions. |

# Bug Reports
## Base model
*   No issues found.

## Divergent model
*   **Vulnerability 1: Information Leakage via Differential Error Codes (CWE-209)**  
    *   **Impact:** Attackers can infer device presence/absence, family membership status, and system state changes through distinct error code patterns (401 vs. 404). This violates confidentiality by enabling differential inference attacks, where unauthorized users (user2) gain reconnaissance capabilities through error code analysis.  
    *   **Problematic State(s):**  
        *   `s6`: Performed **user2|remote|DeviceControl**, received **500000404 (CLS_5)**, transitioned to **State s6**, allowing family members to confirm device absence through consistent "Not Found" responses.  
        *   `s7`: Performed **user2|remote|DeviceControl**, received **500000401 (CLS_4)**, transitioned to **State s7**, confirming device presence and revoked permissions through "Unauthorized" errors.  
        *   `s8`: Performed **user2|remote|DeviceControl**, received **500000404 (CLS_5)**, transitioned to **State s8**, leaking device absence or membership revocation status via persistent "Not Found" responses.  
        *   `s9`: Performed **user2|remote|DeviceControl**, received **500000404 (CLS_5)**, transitioned to **State s9**, causing false inference of device absence despite its actual presence, enabling attackers to detect state manipulation attempts.

*   **Vulnerability 2: Incorrect Error Code Mapping (CWE-600)**  
    *   **Impact:** Invalid error code usage creates conflicting system state signals, particularly in operational states where devices exist but return "Not Found" (404) errors. This inconsistency could be weaponized in multi-phase attacks by misleading defenders or enabling logic bypasses.  
    *   **Problematic State(s):**  
        *   `s9`: Performed **user2|remote|DeviceControl**, received **500000404 (CLS_5)**, transitioned to **State s9**. The persistent "Not Found" response conflicts with actual device presence, creating an exploitable discrepancy between system state and error signaling.