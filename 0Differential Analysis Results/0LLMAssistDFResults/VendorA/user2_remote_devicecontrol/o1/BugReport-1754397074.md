# BTB Semantic
```json
{
    "local_user1_DeviceControl": [
        [
            "Operation result: Success. Evidence: 'deviceDataChanged'. Reason: Repeated deviceDataChanged updates with no error signals indicate successful control"
        ]
    ],
    "local_user1_InviteAndAccept": [
        [
            ""
        ],
        [
            ""
        ],
        [
            "Operation result: Success. Evidence: 'FPSPER200'. Reason: The membership addition request returned code 200 indicating success."
        ],
        [
            "Operation result: Failed. Evidence: 'error_code=205002'. Reason: The membership addition was blocked because the user was already a member. However, there is also an indication that the membership was effectively fulfilled due to existing membership."
        ]
    ],
    "local_user1_RemoveDevice": [
        [
            "Operation result: Success. Evidence: 'deviceDeleted'. Reason: Device removal was confirmed by a 'deviceDeleted' notification"
        ]
    ],
    "local_user1_RemoveFromHome": [
        [
            ""
        ],
        [
            "Operation result: Success. Evidence: 'DELETE'; '200'. Reason: The remove operation was successful, as the DELETE request consistently returned an HTTP 200 status."
        ]
    ],
    "local_user2_DeviceControl": [
        [
            "Operation result: Success. Evidence: 'deviceDataChanged'. Reason: Repeated device state changes with no error responses reflect successful operation."
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            "Operation result: Success. Evidence: 'deviceDataChanged'. Reason: Repeated device state changes with no error responses reflect successful operation."
        ]
    ],
    "remote_user1_DeviceControl": [
        [
            "Operation result: Success. Evidence: 'errcode=0'. Reason: Command responses with 'errcode=0' verify successful device control and updated states."
        ]
    ],
    "remote_user2_DeviceControl": [
        [
            "Operation result: Success. Evidence: 'errcode':0'. Reason: A valid command response with errcode=0 indicates successful device control."
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            "Operation result: Failed. Evidence: 'errcode':500000401'. Reason: A nonzero error code indicates the device command was not successful."
        ],
        [
            "Operation result: Failed. Evidence: 'errcode':500000404'. Reason: A nonzero error code indicates the device command was not successful."
        ]
    ]
}
```

# State Semantic
## Base model
| State | Semantic Description |
|-------|----------------------|
| 0     | Initial state. |
| 1     | Error state. |
| 2     | user1 has added the device once; user2 is not invited and has no control or permissions. |
| 3     | user1 has added the device once; user2 is a family member with permanent control rights. |
| 4     | No device has been added by user1; user2 is a family member with permanent control rights for any future devices. |

## Divergent model
| State | Semantic Description |
|-------|----------------------|
| 0 | Initial state. No device is bound, and user2 is not invited or granted any control. |
| 1 | user1 has added the device once; user2 is not invited and has no control. |
| 2 | Error state. |
| 3 | No device is added; user2 is a family member who will gain control rights for any future device user1 adds. |
| 4 | user1 added one device; user2 is a family member with permanent control rights. |
| 5 | user1 has one device added; user2, as a family member, is actively controlling it. |
| 6 | The device is removed; user2 remains a family member and will regain control if user1 re-adds the device. |
| 7 | user1 still has the device; user2’s family membership is revoked, and user2 no longer has control. |
| 8 | user1 removed the device and revoked user2’s family membership; no device is bound, and user2 has no control. |
| 9 | user1 re-added the device a second time, then revoked user2’s family membership; user2 no longer controls the newly added device. |
| 10 | user1 re-added the device a second time; user2 remains a family member with automatic control rights. |

# Bug Reports
## Base model
No issues found.

## Divergent model
*   **Vulnerability 1: Differential Error Code Inference**  
*   **Impact:** This vulnerability enables user2 (whose membership has been revoked) to infer whether the device still exists, was removed, or was re-added based on differing error codes (401 vs. 404). By contrasting “unauthorized” (401) and “not found” (404) responses, user2 can deduce sensitive state changes about the device’s lifecycle, violating the principle that a revoked user should not be able to discern internal system or device information.  
*   **Problematic State(s):**
    *   `s7`: Performed "user2|remote|DeviceControl", received "401 Unauthorized", indicating the device still exists but membership is revoked.  
    *   `s6`: Performed "user2|remote|DeviceControl", received "404 Not Found", revealing the device was removed or otherwise become inaccessible.  
    *   `s8`: Performed "user2|remote|DeviceControl", received "404 Not Found", similarly disclosing that the device was removed or not visible to user2.  
    *   `s9`: Performed "user2|remote|DeviceControl", received "404 Not Found", indicating the device was re-added but still inaccessible—further confirming its renewed existence despite user2’s revoked status.