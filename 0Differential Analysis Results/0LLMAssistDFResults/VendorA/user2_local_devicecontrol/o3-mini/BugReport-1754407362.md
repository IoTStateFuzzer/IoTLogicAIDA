# BTB Semantic
```json
{
    "local_user1_DeviceControl": [
        [
            "Operation result: Success. Evidence: **'mainSwitch data with on set to 1'**; **'mainSwitch','on':1'**; **'mainSwitch' with 'on':1**. Reason: The majority of MQTT payloads consistently indicate that the device's mainSwitch state transitioned to on, confirming that the device control operation executed successfully."
        ]
    ],
    "local_user1_InviteAndAccept": [
        [
            ""
        ],
        [
            ""
        ],
        [
            "Operation result: Success. Evidence: **'FPSPER200'**. Reason: The predominant reasons indicate successful HTTP 200 responses from POST endpoints confirming the invite and acceptance, although a minority of logs contained explicit errors about a non-existent user."
        ],
        [
            "Operation result: Failed. Evidence: **'Home member is already exist in database'**. Reason: The majority of logs report a duplicate membership error in the invite process, establishing failure, while additional error messages regarding a non-existent user further support the operation\u2019s failure."
        ]
    ],
    "local_user1_RemoveDevice": [
        [
            "Operation result: Success. Evidence: 'deviceDeleted'. Reason: The integrated analysis indicates that the removal operation succeeded based on a consistent MQTT notification 'deviceDeleted', which is present in every report and is supported by HTTP DELETE indications where applicable."
        ]
    ],
    "local_user1_RemoveFromHome": [
        [
            ""
        ],
        [
            "Operation result: Success. Evidence: 'DELETE'. Reason: The evidence consistently shows that a DELETE operation returning a success status (whether expressed as FPSPER200, HTTP 200 or similar) was executed, thereby confirming the RemoveFromHome operation."
        ]
    ],
    "local_user2_DeviceControl": [
        [
            "Operation result: Success. Evidence: 'on:1'. Reason: Consistent MQTT notifications report a state change to on (on:1), confirming successful device control as evidenced by the raw 'on:1' fragment present in every report."
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            "Operation result: Undetermined. Evidence: 'on:0'. Reason: All reports indicate the device state as off (on:0); however, conflicting interpretations\u2014some viewing the off state as expected and others as a deviation from the intended outcome\u2014make the overall determination inconclusive."
        ]
    ],
    "remote_user1_DeviceControl": [
        [
            "Operation result: Success. Evidence: '**'errcode':0**'. Reason: MQTT ACK responses consistently showing errcode 0 confirm the successful execution of the DeviceControl command."
        ]
    ],
    "remote_user2_DeviceControl": [
        [
            "Operation result: Success. Evidence: '**'errcode':0**'. Reason: The repeated MQTT acknowledgments with error code 0 consistently confirm that the device control operation executed correctly."
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            "Operation result: Failed. Evidence: '**'errcode':500000401**'. Reason: The consistent appearance of error code 500000401 in the MQTT commandRsp messages clearly indicates a failure in the device control operation."
        ],
        [
            "Operation result: Failed. Evidence: '**'errcode':500000404**'. Reason: The common error code 500000404 in the MQTT commandRsp packets decisively evidences that the device control action failed."
        ]
    ]
}
```

# State Semantic
## Base model
| State | Semantic Description |
|-------|----------------------|
| s0 | Initial state. |
| s1 | Error state. |
| s2 | user1 has added a device instance once (addition count = 1) without initiating any sharing; user2 holds no control permissions. |
| s3 | user1 added a device instance (addition count = 1) and then issued an invitation that was automatically accepted, designating user2 as a family member with permanent control rights over all user1’s devices (even if a device is removed and re-added). |
| s4 | user1 executed an invitation (automatically accepted) without adding a device; user2 is designated as a family member and will have permanent control rights for any future device additions. |

## Divergent model
| State | Semantic Description |
|-------|----------------------|
| s0 | Initial state. |
| s1 | User1 has added one device (device addition count = 1) without initiating any sharing; user2 holds no permissions. |
| s2 | Error state. |
| s3 | User1 issued an invitation that was automatically accepted without adding any device instance, so user2 becomes a family member with permanent control rights. |
| s4 | User1 added one device (device addition count = 1) and then invited user2, whose automatic acceptance makes them a family member with permanent control rights. |
| s5 | User1 added one device (device addition count = 1) and shared it via an accepted invite, resulting in user2 becoming a family member with permanent control rights and exercising device control. |
| s6 | User1 added the device and invited user2 as a family member, then removed the device; however, due to family membership rules, user2 retains permanent control rights even though no active device remains. |
| s7 | User1 has an active device (device addition count = 1) but later revokes sharing by removing user2 from home, thereby revoking user2’s family membership and permanent control rights. |
| s8 | User1 added a device and invited user2, then removed the device and executed a remove-from-home action, leaving no active device instance and revoking user2’s control privileges. |
| s9 | User1 added a device and invited user2 (becoming a family member), then removed the device (reducing the count to 0), re-added a device instance (active count = 1), and finally revoked sharing by removing user2 from home so that user2 loses permanent control rights. |
| s10 | User1 added the device and invited user2 (making user2 a family member), then removed the device and re-added a device instance (device addition count = 1); with no removal from home, user2 retains permanent family membership and control rights. |

# Bug Reports
## Base model
* No issues found.

## Divergent model
* **Vulnerability 1: Unauthorized Device Control Despite Revoked Permissions**  
  **Impact:** In state s7, multiple reports indicate that after user2’s family membership and control rights have been revoked through a RemoveFromHome action, a local DeviceControl operation by user2 still returns a successful response. This behavior breaches the intended access control policy by allowing an unprivileged user to execute device control commands. The inconsistency compromises the integrity of the system’s permission enforcement and creates a potential avenue for attackers to manipulate devices without proper authorization.  
  **Problematic State(s):**
    * `s7`: Performed **user2|local|DeviceControl** and received **Operation result: Success** despite the revocation of permissions, thus enabling unauthorized device control.

* **Vulnerability 2: Ambiguous DeviceControl Response Enabling Differential Inference**  
  **Impact:** In state s9, reports consistently show that following the revocation of user2’s permissions, a local DeviceControl command returns an “Undetermined” result accompanied by evidence (such as “on:0”) and a response symbol (CLS_3). This ambiguous response provides attackers with differential feedback that contrasts with the expected definitive failure signal, potentially allowing them to infer sensitive information about device states or internal status conditions. The leakage of such information undermines confidentiality and opens opportunities for further exploit attempts based on inferred state data.  
  **Problematic State(s):**
    * `s9`: Performed **user2|local|DeviceControl** and received an **Undetermined Operation result** (with evidence “on:0”), creating ambiguities that enable attackers to perform differential inference regarding the underlying system state.