# BTB Semantic
```json
{
    "local_user1_AddDevice": null,
    "local_user1_DeviceControl": [
        [
            "Operation result: Success. Evidence: 'code:200'. Reason: The HTTP PUT packets consistently returned a response containing 200, which is evidenced in a majority of the reports (with additional success flags in several) and is further corroborated by MQTT message confirmations, indicating successful device control execution."
        ]
    ],
    "local_user1_RemoveDevice": [
        [
            "Operation result: Success. Evidence: 'DELETE with code:200 and success true'; 'DELETE with code 200 and success:true'; 'HTTP DELETE with code 200 and success true'; 'DELETE request with 'code':200 and 'success':true'. Reason: The majority of reports provide consistent evidence\u2014DELETE requests returning a 200 status with success true\u2014which confirms that the RemoveDevice operation was executed successfully. Although one report cited a GET deviceInfo result showing status ONLINE, this minority evidence does not overcome the clear consensus from the DELETE operation packets."
        ]
    ],
    "local_user1_SharePlug": [
        [
            "Operation result: Success. Evidence: 'code:200, success:true'. Reason: The HTTP POST share endpoint consistently returned a 200 code with success:true, indicating that the operation was successful."
        ],
        [
            "Operation result: Failed. Evidence: 'success:false'. Reason: The POST share endpoint consistently signaled failure by returning success:false, indicating an operational failure."
        ]
    ],
    "local_user1_UnsharePlug": [
        [
            "Operation result: Success. Evidence: 'code 200'. Reason: The consistent appearance of the HTTP 200 status across all messages, as evidenced by the identical code response in multiple packets (e.g., 'with code 200', ''code':200', 'code:200'), confirms that the unshare operation executed successfully."
        ]
    ],
    "remote_user2_AcceptDeviceShare": [
        [
            ""
        ],
        [
            "Operation result: Success. Evidence: ''code':200'. Reason: The payload across reports consistently shows a HTTP 200 status code, confirming the operation\u2019s successful completion."
        ],
        [
            "Operation result: Failed. Evidence: ''success':false'. Reason: The payloads uniformly indicate a false success flag, demonstrating that the operation did not complete successfully."
        ],
        [
            "Operation result: Failed. Evidence: ''success':false'. Reason: A false success flag is present throughout the payloads, which objectively confirms the operation failure."
        ]
    ],
    "remote_user2_DeviceControl": [
        [
            "Operation result: Success. Evidence: 'code':200. Reason: The HTTP PUT packets and MQTT messages consistently indicate a code 200 response, confirming successful device control execution."
        ],
        [
            ""
        ],
        [
            "Operation result: Failed. Evidence: 'code':9017. Reason: The HTTP PUT responses uniformly present error code 9017 with false success indicators, establishing a device control failure."
        ]
    ]
}
```

# State Semantic
## Base model
| State | Semantic Description |
|-------|----------------------|
| s0 | Initial state with no device additions or sharing actions initiated. |
| s1 | user1 has added the device once; no sharing invitation has been issued, so user2 is not invited and holds no control permissions. |
| s2 | Error state. |
| s3 | user1 has added the device and issued a sharing invitation (via SharePlug); user2 has been invited but has not yet accepted, so no control permissions are granted. |
| s4 | user1 added the device and sent a sharing invitation; after user2 manually accepted, user2 now holds direct device sharing permission limited to this specific device instance. |

## Divergent model
| State | Semantic Description |
|-------|----------------------|
| s0 | Initial state. No device has been added and no sharing actions have taken place. |
| s1 | user1 added the device once (device addition count = 1) with no sharing initiated; user2 has not been invited and holds no permissions. |
| s2 | Error state. |
| s3 | user1 added the device once and issued a share invitation (direct device sharing); user2 has been invited but has not yet accepted, so no control permission is granted. |
| s4 | user1 added the device once and shared it; user2 accepted the invitation and now holds temporary direct control permission limited to this device instance. |
| s5 | user1 added the device once, shared it, and user2 accepted the invitation; however, user1 later revoked the sharing, which removed user2’s direct control permission while leaving the device added. |
| s6 | user1 added the device once, shared it and had user2’s acceptance, but then removed the device; as a result, user2’s direct sharing permission is revoked and the device instance is deactivated. |
| s7 | user1 added the device once and initially shared it (with user2 accepting), then revoked the share and re-initiated sharing; currently, a new share invitation is active and pending user2’s acceptance, so no control permission is in effect until accepted. |

# Bug Reports
## Base model
No issues found.

## Divergent model
* **Vulnerability 1: Differential Response Information Leakage**  
  **Impact:**  
  Multiple reports confirm that in the Divergent model, the remote AcceptDeviceShare operation produces different failure response symbols depending on the device state (e.g., CLS_2 in s5, CLS_3 in s6). These distinct responses enable an attacker (user2) to infer sensitive internal state details about the device sharing lifecycle, such as whether a share invitation was revoked or if the device has been removed. This differential feedback constitutes unauthorized information disclosure through side-channel inference attacks, which would allow user2 to gain insights about the system beyond their authorized permissions. Although the AcceptDeviceShare operation succeeds legitimately in state s7 when a new invitation is active, the differing failure codes in revoked or removed states pose a security risk by leaking system state information that should remain confidential.  
   
  **Problematic State(s):**  
  * `s5`: Performed user2|remote|AcceptDeviceShare, received failure response with Symbol: CLS_2, indicating sharing was revoked and revealing internal share revocation status.  
  * `s6`: Performed user2|remote|AcceptDeviceShare, received failure response with Symbol: CLS_3, indicating device removal and revealing the device lifecycle event.  

No other vulnerabilities or unauthorized access issues were found in either the Base or Divergent model. All other AcceptDeviceShare operations respond according to legitimate sharing state and permission rules without exposing sensitive information or allowing unauthorized access.