# BTB Semantic
```json
{
    "local_user1_AddDevice": null,
    "local_user1_DeviceControl": [
        [
            "Operation result: Success. Evidence: 'success':true. Reason: The 200 status code with 'success':true indicates the device property update completed successfully"
        ]
    ],
    "local_user1_RemoveDevice": [
        [
            "Operation result: Success. Evidence: 'code=200, success=true'; 'code':200,'success':true'; 'code:200, success:true'. Reason: The request returned code 200 with success=true, indicating device removal was successful."
        ]
    ],
    "local_user1_SharePlug": [
        [
            "Operation result: Success. Evidence: 'code=200'; 'success=true'. Reason: The share request returned code=200 with success=true."
        ],
        [
            "Operation result: Failed. Evidence: 'success=false'. Reason: The share request returned success=false."
        ]
    ],
    "local_user1_UnsharePlug": [
        [
            "Operation result: Success. Evidence: '200' 'success'. Reason: Code=200 with success=true indicates the unshare operation completed successfully."
        ]
    ],
    "remote_user2_AcceptDeviceShare": [
        [
            ""
        ],
        [
            "Operation result: Success. Evidence: '200'. Reason: The server responded with code 200, indicating acceptance."
        ],
        [
            "Operation result: Failed. Evidence: 'success':false. Reason: The payload indicates success=false, producing a failure result."
        ],
        [
            "Operation result: Failed. Evidence: 'success':false. Reason: The payload indicates success=false, producing a failure result."
        ]
    ],
    "remote_user2_DeviceControl": [
        [
            "Operation result: Success. Evidence: 'code=200'. Reason: Majority consensus indicates code=200 signifies a successful update. Additional evidence mentions a success flag."
        ],
        [
            ""
        ],
        [
            "Operation result: Failed. Evidence: 'code=9017'. Reason: Majority consensus indicates code=9017 denotes an operation failure. Additional evidence includes a false success flag."
        ]
    ]
}
```

# State Semantic
## Base model
| State | Semantic Description                                                                                   |
|-------|--------------------------------------------------------------------------------------------------------|
| s0    | Initial state. No device is added and user2 has no permissions.                                       |
| s1    | user1 has added the device once; user2 is not invited and has no permissions.                          |
| s2    | Error state.                                                                                          |
| s3    | user1 has added the device once and initiated a direct share invitation to user2; user2 has not accepted yet. |
| s4    | user1 has added the device once, shared it directly with user2, and user2 has accepted the share, gaining direct control. |

## Divergent model
| State | Semantic Description |
|-------|----------------------|
| 0     | Initial state. |
| 1     | User1 has added the device for the first time; user2 is not invited or granted any permissions yet. |
| 2     | Error state. |
| 3     | User1 has the device (first addition) and invited user2 for direct sharing, but user2 has not accepted yet. |
| 4     | User1 has the device (first addition) and user2 has accepted the direct share and currently holds control permissions. |
| 5     | User1 still has the device and has unshared it from user2, revoking user2’s direct sharing permission. |
| 6     | User1 removed the device from their account, invalidating user2’s direct-sharing permission. |
| 7     | User1 still has the device (first addition) and re-invited user2 after unsharing; user2 has not accepted the new invitation yet. |

# Bug Reports
## Base model
No issues found.

## Divergent model
*   **Vulnerability 1: Differential Inference via Distinct Failure Codes**  
*   **Impact:** By issuing the same “AcceptDeviceShare” request in different states, the attacker (user2) receives varied failure codes (CLS_2 versus CLS_3). This discrepancy reveals whether the device has merely been unshared (CLS_2) or fully removed (CLS_3) from user1’s account. As a result, user2 can infer user1’s private device ownership status, disclosing sensitive system state information without authorization.

*   **Problematic State(s):**
    *   `s4`: Performed “AcceptDeviceShare”, received “CLS_2” (failure), indistinguishable from s5 but different from s6, enabling inference about device ownership state.  
    *   `s5`: Performed “AcceptDeviceShare”, received “CLS_2” (failure), indistinguishable from s4 but different from s6, enabling inference about device ownership state.  
    *   `s6`: Performed “AcceptDeviceShare”, received “CLS_3” (failure), revealing the device was fully removed from user1’s account, causing unauthorized leakage of system state.