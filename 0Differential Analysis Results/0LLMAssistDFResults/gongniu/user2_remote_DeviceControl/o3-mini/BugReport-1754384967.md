# BTB Semantic
```json
{
    "local_user1_AddDevice": null,
    "local_user1_DeviceControl": [
        [
            "Operation result: Success. Evidence: ''code':200'. Reason: HTTP PUT responses consistently returned a 200 status with success confirmation, and accompanying MQTT messages indicated corresponding state changes, confirming successful execution of the device control command."
        ]
    ],
    "local_user1_RemoveDevice": [
        [
            "Operation result: Success. Evidence: 'DELETE'; '200'. Reason: The DELETE request is validated by consistent evidence across reports, with every packet clearly indicating the use of DELETE and returning HTTP status 200, thereby confirming the successful completion of the RemoveDevice operation."
        ]
    ],
    "local_user1_SharePlug": [
        [
            "Operation result: Success. Evidence: ''code':200'; 'success':true'. Reason: The POST packet to /mos/share/v1/devices consistently returned a 200 response with success true, confirming proper operation execution."
        ],
        [
            "Operation result: Failed. Evidence: ''success':false'. Reason: The POST packet to /mos/share/v1/devices consistently indicated a false success flag, objectively showing operation failure."
        ]
    ],
    "local_user1_UnsharePlug": [
        [
            "Operation result: Success. Evidence: 'POST /mos/share/v1/devices/cancel'. Reason: The unshare operation is validated by consistent POST requests to /mos/share/v1/devices/cancel with HTTP 200 responses, confirming the cancellation operation."
        ]
    ],
    "remote_user2_AcceptDeviceShare": [
        [
            ""
        ],
        [
            "Operation result: Success. Evidence: 'code:200'; 'success:true'. Reason: The majority of evidence consistently shows the HTTP code 200 in combination with a true success flag, confirming that the device share acceptance was successful."
        ],
        [
            "Operation result: Failed. Evidence: 'success:false'. Reason: Consistent evidence reveals a false success flag, indicating that the device share acceptance failed."
        ],
        [
            "Operation result: Failed. Evidence: 'success:false'. Reason: Repeated inclusion of a false success indicator in the payload confirms the operation did not succeed."
        ]
    ],
    "remote_user2_DeviceControl": [
        [
            "Operation result: Success. Evidence: 'code':200. Reason: The HTTP response consistently reports a 200 status \u2013 with the presence of 'code':200 in every packet \u2013 indicating a successful DeviceControl execution with clear confirmation from the network evidence."
        ],
        [
            ""
        ],
        [
            "Operation result: Failed. Evidence: 'code':9017. Reason: The HTTP response uniformly presents error code 9017 across the packets, showing clear indication of operation failure through the explicit error flag."
        ]
    ]
}
```

# State Semantic
## Base model
| State | Semantic Description |
|-------|----------------------|
| s0    | Initial state; no device has been added and no sharing invitation has been initiated by user1. |
| s1    | user1 added the device once; no sharing invitation was issued, so user2 holds no permissions. |
| s2    | Error state. |
| s3    | user1 added the device once and issued a direct sharing invitation; user2 has been invited but has not accepted, so control rights are not granted. |
| s4    | user1 added the device once and issued a sharing invitation that user2 accepted, granting user2 direct control permission limited to this specific device instance. |

## Divergent model
| State | Semantic Description |
|-------|----------------------|
| s0 | Initial state with no device added and no sharing initiated. |
| s1 | user1 has added the device once (addition count = 1) with no sharing invitation sent; user2 has no permissions. |
| s2 | Error state. |
| s3 | user1 has added the device and initiated a direct sharing invitation (SharePlug); user2 is invited but has not yet accepted, so no control permission is active. |
| s4 | user1 has added the device (addition count = 1) and shared it via a direct invitation which user2 accepted, thereby granting temporary direct control permission for that specific device instance. |
| s5 | user1’s device remains added and shared, and user2—having accepted the invitation—actively exercises direct control over the current device instance. |
| s6 | After user2 exercised control, user1 revokes sharing (UnsharePlug), which cancels user2’s direct control permission while the device remains added. |
| s7 | Following the previous revocation, user1 re-initiates a direct sharing invitation on the existing device, placing user2 in a pending state awaiting acceptance. |
|8     | user1 removes the device instance, which inherently revokes user2’s direct control permission since permissions tied to the specific device instance are lost upon removal. |

# Bug Reports
## Base model
* No issues found.

## Divergent model
* **Vulnerability 1: Unauthorized Remote Device Control in Revoked or Pending Permission States**  
  **Impact:** Multiple independent analyses reveal that user2 is able to execute remote DeviceControl operations successfully even when the device’s access rules stipulate that such permissions should be revoked or not yet activated. In state s6—after user1 revokes sharing—user2’s control permission is canceled; in state s7—while a sharing invitation remains pending—user2 has not earned valid permissions. Despite these conditions, the system returns a success response to user2’s DeviceControl commands. This flaw violates the intended access control policies and undermines the confidentiality, integrity, and availability of the device, thereby exposing it to potential unauthorized manipulations and privilege escalation exploits.  
  **Problematic State(s):**
    * `s6`: Performed **user2|remote|DeviceControl** (in conjunction with **user1|local|DeviceControl**), received **Operation result: Success**, causing unauthorized control despite revoked sharing.
    * `s7`: Performed **user2|remote|DeviceControl** (with **user1|local|DeviceControl**), received **Operation result: Success**, causing unauthorized control even though sharing is only in a pending state.

* **Vulnerability 2: Differential Response Behavior Leading to State Inference**  
  **Impact:** One analysis report highlights that while states s6 and s7 return an unintended success response for remote DeviceControl requests, state s8 correctly denies such operations. This differential response behavior provides a clear observable contrast that an attacker may exploit to accurately infer the internal state and permission status of the device. By being able to distinguish between states based on the system’s responses, an attacker gains valuable insight into the authorization mechanism that can be leveraged to plan further unauthorized actions.  
  **Problematic State(s):**
    * `s6`: Performed **user2|remote|DeviceControl**, received **Operation result: Success**, exposing inconsistent behavior with expected permission enforcement.
    * `s7`: Performed **user2|remote|DeviceControl**, received **Operation result: Success**, reinforcing the differential response pattern compared to correctly enforced states like s8.