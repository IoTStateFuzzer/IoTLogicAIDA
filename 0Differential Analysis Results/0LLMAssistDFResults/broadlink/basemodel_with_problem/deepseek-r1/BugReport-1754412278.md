# BTB Semantic
```json
{
    "local_user1_AddDevice": [
        [
            "Operation result: Success. Evidence: 'status':0,'msg':'ok''; '/group/dev/manage status:0'; 'Bidirectional UDP exchange between device_0 and user1_local'. Reason: Device management API returned explicit success status (0) with 'ok' confirmation at '/group/dev/manage' endpoint, corroborated by sustained bidirectional UDP packet exchange pattern between device and local user during provisioning."
        ]
    ],
    "local_user1_DeviceControl": [
        [
            "Operation result: Undetermined. Evidence: ''. Reason: Bidirectional UDP traffic with 2-packet exchange observed, but payloads contained non-interpretable patterns (e.g., 'Abs_LenX' sequences) without explicit status codes or operation keywords. Header fragment 'user1_local' detected but lacked supporting payload validation. Ambiguous source addressing (device_0 vs user1_local) and encoded payloads prevented conclusive outcome determination despite bidirectional pattern."
        ]
    ],
    "local_user1_InviteToHome": [
        [
            "Operation result: Success. Evidence: 'status':0,'error':0,'msg':'ok'. Reason: Invitation endpoint returned explicit success codes (status:0, error:0) with 'ok' confirmation, confirming valid QR code generation for local device invitation."
        ],
        [
            "Operation result: Success. Evidence: 'error':0,'status':0,'msg':'ok'; 'familymember':[{'userid':'112dae9018cdebd9cc0614003ebfd219'}'. Reason: Consistent success indicators (error:0/status:0) with operational confirmation through family member list showing user2's added status (type:1) post-invitation."
        ]
    ],
    "local_user1_RemoveDevice": null,
    "local_user1_RemoveFromHome": [
        [
            "Operation result: Success. Evidence: 'error':0,'status':0,'msg':'ok'. Reason: Removal API endpoint returned explicit success payload (error:0, status:0, msg:'ok') confirming deletion protocol compliance. Note: Post-execution membership verification detected persistent target user (112dae9018cdebd9cc0614003ebfd219) in system records."
        ]
    ],
    "local_user2_DeviceControl": [
        [
            "Operation result: Success. Evidence: 'HTTP POST responses to /device/control/v2/sdkcontrol'; 'bidirectional UDP flow'; 'event:Response header'. Reason: Sustained bidirectional HTTP/UDP control patterns with response confirmation (no error codes). Minority evidence shows one instance of command termination without response, insufficient to override operational continuity."
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            "Operation result: Success. Evidence: 'bidirectional UDP exchange between user2_local-device_0'; 'operational flow without termination signals'. Reason: Local UDP packet exchange confirms active control channel maintenance. Minority evidence of limited packet volume/obfuscation noted but does not contradict success determination."
        ]
    ],
    "remote_user1_DeviceControl": null,
    "remote_user2_AcceptInvite": [
        [
            "Operation result: Success. Evidence: '/appsync/group/member/invited/joinfamily|||||FPSPER{'error':0,'status':0,'msg':'ok'}'. Reason: HTTP POST to joinfamily endpoint with explicit success indicators (error:0, status:0, 'ok' message) confirming invitation acceptance."
        ]
    ],
    "remote_user2_DeviceControl": [
        [
            ""
        ],
        [
            "Operation result: Success. Evidence: 'POST /device/control/v2/sdkcontrol'; 'name':'Response'; 'pwr:0/1'. Reason: Valid control command structure with Response confirmation and alternating power state values (0/1) in payload data, demonstrating successful state transitions without error indicators."
        ],
        [
            ""
        ],
        [
            "Operation result: Failed. Evidence: 'name':'ErrorResponse'; 'status':-7; 'device reset, please rebind'. Reason: Explicit error namespace with negative status code (-7) and reset requirement message confirms authentication/control failure requiring device reinitialization."
        ]
    ],
    "remote_user2_QuitHome": [
        [
            "Operation result: Success. Evidence: '/appsync/group/member/quitfamily|||||FPSPER{'error':0,'status':0,'msg':'ok'}'. Reason: HTTP POST to quitfamily endpoint responded with status:0/error:0 and confirmation message 'ok'."
        ],
        [
            "Operation result: Success. Evidence: '/appsync/group/member/quitfamily|||||FPSPER{'error':0,'status':0,'msg':'ok'}'. Reason: Core quitfamily operation succeeded with status:0/error:0 and 'ok' message, though unrelated device errors occurred in subsequent processes."
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            "Operation result: Failed. Evidence: '/appsync/group/member/quitfamily|||||FPSPER{'status':-30107,'msg':'\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd'}'. Reason: Quitfamily request rejected with status code -30107 and unreadable error message, indicating system-level operation failure."
        ]
    ],
    "remote_user2_ScanQRCode": [
        [
            "Operation result: Success. Evidence: 'error':0,'status':0,'msg':'ok'. Reason: Consistent success confirmation through HTTP 200-equivalent status code (0) with explicit 'ok' message in QR scan response payload."
        ],
        [
            "Operation result: Failed. Evidence: 'error':-2010,'status':-2010. Reason: Negative error code -2010 in payload confirms QR scan failure, indicating invalid/malformed code authentication rejection."
        ],
        [
            "Operation result: Failed. Evidence: 'error':-2011,'status':-2011. Reason: Error code -2011 demonstrates parameter validation failure, typically indicating expired/overused QR codes in smart home protocols."
        ]
    ]
}
```

# State Semantic
## Base model

| State | Semantic Description |
|-------|----------------------|
| 0 | Initial state. |
| 1 | Error state. |
| 2 | user1 added the device once; user2 is not invited. |
| 3 | user1 added the device once; user2 is invited to the family but has not accepted. |
| 4 | user1 has not added the device; user2 is invited to the family but has not accepted. |
| 5 | user1 added the device once; user2 has scanned the family invitation but has not accepted. |
| 6 | user1 added the device once; user2 is a family member with permanent control permissions. |
| 7 | user1 added the device once; user2 is a family member with permanent control permissions. |
| 8 | user1 has not added the device; user2 is a family member with permanent control permissions. |
| 9 | user1 has not added the device; user2 is a family member with permanent control permissions. |
| 10 | user1 has not added the device; user2 has scanned the family invitation but has not accepted. |
| 11 | user1 has not added the device; user2 is not invited. |
| 12 | user1 added the device once; user2 is not invited. |
| 13 | user1 added the device once; user2 is not invited. |
| 14 | user1 added the device once; user2 is not invited. |
| 15 | user1 added the device once; user2 is not invited. |
| 16 | user1 has not added the device; user2 is not invited. |
| 17 | user1 added the device once; user2 is not invited. |
| 18 | user1 added the device once; user2 is not invited. |
| 19 | user1 has not added the device; user2 is not invited. |
| 20 | user1 added the device once; user2 is not invited. |
| 21 | user1 added the device twice; user2 is not invited. |
| 22 | user1 added the device twice; user2 is not invited. |
| 23 | user1 added the device twice; user2 is not invited. |
| 24 | user1 added the device once; user2 is not invited. |
| 25 | user1 has not added the device; user2 is not invited. |
| 26 | user1 added the device once; user2 is not invited. |
| 27 | user1 added the device once; user2 is not invited. |
| 28 | user1 added the device once; user2 is invited to the family but has not accepted. |
| 29 | user1 has not added the device; user2 is invited to the family but has not accepted. |
| 30 | user1 added the device once; user2 is invited to the family but has not accepted. |
| 31 | user1 added the device once; user2 is invited to the family but has not accepted. |
| 32 | user1 added the device twice; user2 is invited to the family but has not accepted. |
| 33 | user1 has not added the device; user2 is invited to the family but has not accepted. |
| 34 | user1 added the device once; user2 is invited to the family but has not accepted. |

# Bug Reports
## Base model
*   **Issue Description:** Inconsistent device control permissions after user2 quits or is removed from family membership.
    *   **Problematic State(s):**
        *   `s13`: Performed **user2|remote|DeviceControl**, received **Success**, transitioned to **State 13**, causing **user2 retains device control despite being removed from family membership**.
        *   `s14`: Performed **user2|remote|DeviceControl**, received **Success**, transitioned to **State 14**, causing **user2 retains device control despite being removed from family membership**.
        *   `s18`: Performed **user2|remote|DeviceControl**, received **Success**, transitioned to **State 18**, causing **user2 retains device control despite being removed from family membership**.
        *   `s20`: Performed **user2|remote|DeviceControl**, received **Success**, transitioned to **State 20**, causing **user2 retains device control despite quitting family membership**.
        *   `s25`: Performed **user2|remote|DeviceControl**, received **Failed**, transitioned to **State 25**, causing **inconsistent behavior compared to state 20 where control was retained**.
        *   `s30`: Performed **user2|remote|DeviceControl**, received **Success**, transitioned to **State 30**, causing **unauthorized device control by non-family member**.

*   **Issue Description:** Inconsistent error handling for `QuitHome` operation when user2 is not a family member.
    *   **Problematic State(s):**
        *   `s11`: Performed **user2|remote|QuitHome**, received **{'status':-30107,'msg':'������������'}**, transitioned to **State 11**, causing **user2 to receive an unclear error message when attempting to quit a non-existent family membership**.
        *   `s12`: Performed **user2|remote|QuitHome**, received **{'status':-30107,'msg':'������������'}**, transitioned to **State 12**, causing **same unclear error message**.
        *   `s13`: Performed **user2|remote|QuitHome**, received **{'status':-30107,'msg':'������������'}**, transitioned to **State 13**, causing **same unclear error message**.
        *   `s14`: Performed **user2|remote|QuitHome**, received **{'status':-30107,'msg':'������������'}**, transitioned to **State 14**, causing **same unclear error message**.
        *   `s15`: Performed **user2|remote|QuitHome**, received **{'status':-30107,'msg':'������������'}**, transitioned to **State 15**, causing **same unclear error message**.
        *   `s16`: Performed **user2|remote|QuitHome**, received **{'status':-30107,'msg':'������������'}**, transitioned to **State 16**, causing **same unclear error message**.
        *   `s21`: Performed **user2|remote|QuitHome**, received **{'status':-30107,'msg':'������������'}**, transitioned to **State 21**, causing **same unclear error message**.
        *   `s22`: Performed **user2|remote|QuitHome**, received **{'status':-30107,'msg':'������������'}**, transitioned to **State 22**, causing **same unclear error message**.
        *   `s26`: Performed **user2|remote|QuitHome**, received **{'status':-30107,'msg':'������������'}**, transitioned to **State 26**, causing **same unclear error message**.
        *   `s31`: Performed **user2|remote|QuitHome**, received **{'status':-30107,'msg':'������������'}**, transitioned to **State 31**, causing **same unclear error message**.
        *   `s32`: Performed **user2|remote|QuitHome**, received **{'status':-30107,'msg':'������������'}**, transitioned to **State 32**, causing **same unclear error message**.

*   **Issue Description:** Information leakage through differential error responses in ScanQRCode operations.
    *   **Problematic State(s):**
        *   `s6`: Performed **user2|remote|ScanQRCode**, received **Failed (error:-2010)**, transitioned to **State 6**, causing **leakage of previous family membership status**.
        *   `s7`: Performed **user2|remote|ScanQRCode**, received **Failed (error:-2011)**, transitioned to **State 7**, causing **leakage of duplicate invitation state**.
