# BTB Semantic
```json
{
    "local_user1_AddDevice": [
        [
            "Operation result: Undetermined. Evidence: ''. Reason: Device management API responses showed success indicators (status 0, 'ok' message), but overall traffic lacked conclusive device-addition evidence. Encrypted UDP patterns were present without operation-specific markers, and critical endpoints showed no direct device-addition payloads."
        ]
    ],
    "local_user1_DeviceControl": [
        [
            "Operation result: Undetermined. Evidence: 'UDP traffic with encrypted payloads'; 'user1_local'; 'Pattern: Bidirectional traffic but insufficient response verification'. Reason: No explicit status codes in encrypted UDP payloads and missing device confirmation packet despite command traffic with header 'user1_local'. Insufficient traffic patterns prevent definitive status verification."
        ]
    ],
    "local_user1_InviteToHome": [
        [
            "Operation result: Success. Evidence: ''error':0'; ''status':0'; ''msg':'ok''. Reason: QR code invitation generation succeeded with affirmative API response codes (status:0, error:0) and confirmation message ('ok') indicating operational success."
        ],
        [
            "Operation result: Success. Evidence: ''error':0'; ''status':0'; ''msg':'ok''. Reason: QR invitation system functioning validated through consistent success indicators (status:0/error:0) with 'ok' confirmation in API payload, supplemented by secondary acceptance activity."
        ]
    ],
    "local_user1_RemoveDevice": null,
    "local_user1_RemoveFromHome": [
        [
            "Operation result: Success. Evidence: ''error':0,'status':0,'msg':'ok''; '{'error':0,'status':0,'msg':'ok''}. Reason: Member removal operation succeeded with API responses confirming success indicators (error=0, status=0) and operational confirmation message 'ok'."
        ]
    ],
    "local_user2_DeviceControl": [
        [
            "Operation result: Success. Evidence: 'name':'Response'; 'UDP exchange between device_0 and user2_local'; 'Bidirectional UDP'. Reason: Device control succeeded with HTTP status 0 and Response confirmations, reinforced by sustained bidirectional UDP exchanges exhibiting command-response structure absent error signals."
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            "Operation result: Undetermined. Evidence: 'No decisive evidence'; 'UDP ''Abs_Len'' patterns'. Reason: Inconclusive due to encrypted UDP payloads with fragmented/absent control indicators, preventing verification; observed bidirectionality lacked decrypted success/error confirmation."
        ]
    ],
    "remote_user1_DeviceControl": null,
    "remote_user2_AcceptInvite": [
        [
            "Operation result: Success. Evidence: ''error':0,'status':0,'msg':'ok''. Reason: Successful remote invitation acceptance confirmed by response payload from 'joinfamily' endpoint with error:0, status:0, and 'ok' message."
        ]
    ],
    "remote_user2_DeviceControl": [
        [
            ""
        ],
        [
            "Operation result: Success. Evidence: ''name':'Response''. Reason: Consistent payload evidence with 'Response' event identifiers across execution patterns, confirming successful command acknowledgment without error signatures in control traffic."
        ],
        [
            ""
        ],
        [
            "Operation result: Failed. Evidence: ''name':'ErrorResponse','status':-7'. Reason: Explicit error payload with status code -7 indicating device malfunction and reset requirement, per negative status coding and error response patterns."
        ]
    ],
    "remote_user2_QuitHome": [
        [
            "Operation result: Success. Evidence: 'status':0,'msg':'ok'. Reason: Explicit success response from quitfamily endpoint with status code 0 and 'ok' message."
        ],
        [
            "Operation result: Success. Evidence: 'error':0,'status':0,'msg':'ok'; 'status':0,'msg':'ok'. Reason: Success confirmation through status code 0 and 'ok' message, with variations showing the presence of additional 'error':0 field."
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            "Operation result: Failed. Evidence: 'status':-30107,'msg':'\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd'. Reason: Negative status code (-30107) combined with error message indicates operation rejection."
        ]
    ],
    "remote_user2_ScanQRCode": [
        [
            "Operation result: Success. Evidence: 'error':0,'status':0,'msg':'ok''. Reason: Success confirmed through status code 0 and explicit 'ok' message in device payload."
        ],
        [
            "Operation result: Failed. Evidence: 'error':-2010,'status':-2010'. Reason: Operation rejection indicated by negative error code -2010 and matching status code."
        ],
        [
            "Operation result: Failed. Evidence: 'error':-2011,'status':-2011'. Reason: Protocol-level failure confirmed through negative error code -2011 with consistent status verification."
        ]
    ]
}
```

# State Semantic
## Base model

| State | Semantic Description |
|-------|----------------------|
| S0 | Initial state: user1 has not added the device; user2 is not invited to the family. |
| S1 | user1 added the device; user2 is not invited to the family. |
| S2 | Error state. |
| S3 | user1 added the device; user2 is invited to the family but has not accepted. |
| S4 | user1 has not added the device; user2 is invited to the family but has not accepted. |
| S5 | user1 added the device; user2 has scanned the family invitation QR code but has not accepted. |
| S6 | user1 added the device; user2 is a family member with permanent control rights (accepted the invitation). |
| S7 | user1 added the device; user2 is a family member with permanent control rights (accepted the invitation). |
| S8 | user1 has not added the device; user2 is a family member with permanent control rights. |
| S9 | user1 has not added the device; user2 is a family member with permanent control rights. |
| S10 | user1 has not added the device; user2 has scanned the family invitation QR code but has not accepted. |
| S11 | user1 added the device; user2 is not a family member (quit) and has no control permissions. |
| S12 | user1 has not added the device; user2 is not a family member (quit) and has no control permissions. |
| S13 | user1 has not added the device; user2 has scanned the family invitation QR code but has not accepted. |
| S14 | user1 added the device; user2 has scanned the family invitation QR code but has not accepted. |

## Divergent model

| State | Semantic Description |
|-------|----------------------|
| 0 | Initial state: user1 has not added the device; device not present. user2 is not a family member and has no control permissions. |
| 1 | user1 added the device once; device present. user2 is not a family member and has no control permissions. |
| 2 | Error state |
| 3 | user1 has not added the device; device not present. user2 is invited but not accepted and has no control permissions. |
| 4 | user1 has not added the device; device not present. user2 is invited but not accepted and has no control permissions. |
| 5 | user1 has not added the device; device not present. user2 is a family member and has control permissions. |
| 6 | user1 has not added the device; device not present. user2 is a family member and has control permissions. |
| 7 | user1 added the device once; device present. user2 is a family member and has control permissions. |
| 8 | user1 added the device once; device present. user2 is a family member and has control permissions. |
| 9 | user1 has not added the device; device not present. user2 is not a family member and has no control permissions. |
| 10 | user1 added the device once; device present. user2 is invited but not accepted and has no control permissions. |
| 11 | user1 added the device once; device present. user2 is invited but not accepted and has no control permissions. |
| 12 | user1 added the device once; device present. user2 is not a family member and has no control permissions. |
| 13 | user1 added the device once; device present. user2 is invited but not accepted and has no control permissions. |
| 14 | user1 has not added the device; device not present. user2 is invited but not accepted and has no control permissions. |
| 15 | user1 added the device once; device present. user2 is a family member and has control permissions. |
| 16 | user1 added the device once; device not present. user2 is a family member and has control permissions. |
| 17 | user1 added the device once; device not present. user2 is not a family member and has no control permissions. |
| 18 | user1 added the device twice; device present. user2 is not a family member and has no control permissions. |
| 19 | user1 added the device once; device present. user2 is not a family member and has no control permissions. |
| 20 | user1 added the device once; device present. user2 is not a family member and has no control permissions. |
| 21 | user1 added the device twice; device present. user2 is not a family member and has no control permissions. |
| 22 | user1 added the device once; device not present. user2 is not a family member and has no control permissions. |
| 23 | user1 added the device once; device not present. user2 is invited but not accepted and has no control permissions. |
| 24 | user1 added the device twice; device present. user2 is invited but not accepted and has no control permissions. |
| 25 | user1 added the device once; device present. user2 is invited but not accepted and has no control permissions. |
| 26 | user1 added the device once; device not present. user2 is a family member and has control permissions. |
| 27 | user1 added the device once; device not present. user2 is not a family member and has no control permissions. |
| 28 | user1 added the device twice; device present. user2 is not a family member and has no control permissions. |
| 29 | user1 added the device twice; device present. user2 is a family member and has control permissions. |
| 30 | user1 added the device once; device present. user2 is a family member and has control permissions. |
| 31 | user1 added the device once; device present. user2 is not a family member and has no control permissions. |
| 32 | user1 added the device twice; device present. user2 is a family member and has control permissions. |

# Bug Reports


## Base model
*   No issues found.

## Divergent model
*   **Vulnerability 1: Unauthorized Device Control by Non-Family Members**  
    **Impact:** Allows non-family members to persistently execute device control operations through local access, even after quitting the family or during device re-addition cycles. Violates confidentiality, integrity, and availability by enabling unauthorized command execution without valid permissions or family membership.  
    **Problematic State(s):**  
        *   `s19`: Performed **user2|local|DeviceControl**, received **CLS_0 (Success)**, transitioned to **State s19**, enabling repeated unauthorized operations after quitting the family.  
        *   `s20`: Performed **user2|local|DeviceControl**, received **CLS_0 (Success)**, transitioned to **State s19**, allowing initial unauthorized access despite never having family membership.  
        *   `s31`: Performed **user2|local|DeviceControl**, received **CLS_0 (Success)**, maintained in **State s31**, demonstrating control retention post-family removal.  
        *   `s30`: Performed **user2|local|DeviceControl**, received **CLS_0 (Success)**, transitioned to **State s30**, showing permissions persist through device removal/re-addition cycles.

*   **Vulnerability 2: State Inference via Differential Error Codes**  
    **Impact:** Protocol-level error code variations (-2010 vs -2011) leak family membership status and device authorization hierarchy, enabling attackers to infer sensitive system state information.  
    **Problematic State(s):**  
        *   `s5/s6`: Contrasting **CLS_1 (error:-2010)** vs **CLS_2 (error:-2011)** responses to ScanQRCode operations reveals whether User2 is a family member.  
        *   `s15/s32`: Differential **CLS_2 (error:-2011)** responses between member/non-member states expose authorization relationships.

*   **Vulnerability 3: Zombie Permission Retention**  
    **Impact:** Maintains control permissions after critical system changes including device removal, re-addition, and family membership revocation, violating permission timeliness and revocation policies.  
    **Problematic State(s):**  
        *   `s16`: After device removal (**s15â†’s16**), retains control capabilities despite device absence.  
        *   `s26/s29`: Device re-addition preserves inherited permissions without re-validation.  
        *   `s28`: Performed **user2|local|DeviceControl** after quitting family, received **CLS_5 (Undetermined)**, suggesting residual access potential despite non-member status.

*   **Vulnerability 4: Device/State Inference via Response Patterns**  
    **Impact:** Differential response types (CLS_NoResponse vs encrypted payloads, CLS_0 vs CLS_5) leak device presence, configuration history, and operational states through protocol symbol variations.  
    **Problematic State(s):**  
        *   `s15/s16`: **CLS_0 (Success)** vs **CLS_NoResponse** contrast reveals device presence/absence.  
        *   `s18`: **CLS_5 (Undetermined)** responses to control attempts expose device re-addition history.  
        *   `s30/s26`: Success/failure pattern differences indicate device state changes.  
        *   `s16 vs s7**: Empty response (CLS_NoResponse) vs encrypted payload enables invitation process inference.

*   **Vulnerability 5: Ambiguous Security State Propagation**  
    **Impact:** Undetermined responses (CLS_5) create ambiguous security states where attackers might retain partial control capabilities despite apparent permission revocation.  
    **Problematic State(s):**  
        *   `s18`: Performed **user2|local|DeviceControl**, received **CLS_5 (Undetermined)**, maintained state while suggesting potential control capability retention.  
        *   `s28**: CLS_5 response after explicit family removal creates uncertainty about effective permission revocation.