# BTB Semantic
```json
{
    "local_user1_AddDevice": [
        [
            "Operation result: Success. Evidence: 'status':0,'msg':'ok'. Reason: Consistent HTTP 200 responses with success status (0) and confirmation messages across all reports confirm successful device addition."
        ]
    ],
    "local_user1_DeviceControl": [
        [
            "Operation result: Undetermined. Evidence: 'No decisive payload evidence'; 'No decisive payload evidence or clear traffic patterns'; 'No relevant payload evidence or clear traffic patterns'. Reason: Traffic analysis shows only length indicators/UDP headers without operation-specific payload evidence or status codes"
        ]
    ],
    "local_user1_InviteToHome": [
        [
            "Operation result: Success. Evidence: ''error':0,'status':0,'msg':'ok','data':{'qrcode':'11Abs_Len14|'}'. Reason: Consistent HTTP 200 equivalent responses with success status (error:0, status:0) and QR code generation confirmation across all reports."
        ],
        [
            "Operation result: Success. Evidence: ''error':0,'status':0,'msg':'ok','data':{'qrcode':'11Abs_Len14|}'. Reason: Uniform success confirmation (error:0, status:0) with QR code payload, verifying successful family member invitation process."
        ]
    ],
    "local_user1_RemoveDevice": null,
    "local_user1_RemoveFromHome": [
        [
            "Operation result: Success. Evidence: '{'error':0,'status':0,'msg':'ok'}'. Reason: Consistent HTTP 200 equivalent responses with success status codes (error:0) and confirmation message ('ok') across all reports for /appsync/group/member/delfamilymember endpoint."
        ]
    ],
    "local_user2_DeviceControl": [
        [
            "Operation result: Success. Evidence: ''status':0'. Reason: Consistent HTTP 200 responses with status:0 across all reports confirm successful control operation."
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            "Operation result: Undetermined. Evidence: 'UDP traffic pattern'; 'No decisive payload evidence'. Reason: Encrypted UDP traffic lacks both explicit success confirmation and error indicators, with no payload evidence of operation completion."
        ]
    ],
    "remote_user1_DeviceControl": null,
    "remote_user2_AcceptInvite": [
        [
            "Operation result: Success. Evidence: '/appsync/group/member/invited/joinfamily|||||FPSPER{'error':0,'status':0,'msg':'ok'}'; '/appsync/group/member/invited/joinfamily' with 'error':0, 'status':0, 'msg':'ok'. Reason: Consistent HTTP 200 equivalent responses with 'ok' message across all reports confirm successful family join operation."
        ]
    ],
    "remote_user2_DeviceControl": [
        [
            ""
        ],
        [
            "Operation result: Success. Evidence: ''name':'Response''. Reason: Consistent successful responses with 'Response' header and control data payloads across all reports."
        ],
        [
            ""
        ],
        [
            "Operation result: Failed. Evidence: ''name':'ErrorResponse', 'message':'device reset, please rebind''; ''status':-7'. Reason: Unanimous error responses indicating device reset requirement with consistent error message and status code."
        ]
    ],
    "remote_user2_QuitHome": [
        [
            "Operation result: Success. Evidence: **'{'error':0,'status':0,'msg':'ok'}**'; **'/appsync/group/member/quitfamily|||||FPSPER{'error':0,'status':0,'msg':'ok'}'**. Reason: Consistent HTTP 200 responses with success status (0) and 'ok' message confirm successful quitfamily operations."
        ],
        [
            "Operation result: Success. Evidence: **'{'error':0,'status':0,'msg':'ok'}**'; **'/appsync/group/member/quitfamily|||||FPSPER{'error':0,'status':0,'msg':'ok'}'**. Reason: Repeated confirmation of successful operations through identical success status codes and messages."
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            "Operation result: Failed. Evidence: **'{'status':-30107,'msg':'\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd'}'**; **'/appsync/group/member/quitfamily|||||FPSPER{'status':-30107,'msg':'\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd'}'**. Reason: Negative status code (-30107) with garbled error message consistently indicates system-level failure in quitfamily operation."
        ]
    ],
    "remote_user2_ScanQRCode": [
        [
            "Operation result: Success. Evidence: ''error':0,'status':0,'msg':'ok''. Reason: Consistent success status codes (error:0, status:0) with confirmation message"
        ],
        [
            "Operation result: Failed. Evidence: ''error':-2010,'status':-2010'. Reason: Consistent negative error codes (error:-2010, status:-2010) indicating system rejection"
        ],
        [
            "Operation result: Failed. Evidence: ''error':-2011,'status':-2011'. Reason: Consistent negative error codes (error:-2011, status:-2011) indicating system rejection"
        ]
    ]
}
```

# State Semantic
## Base model
| State | Semantic Description |
|-------|----------------------|
| 0     | Initial state. |
| 1     | user1 added the device; user2 has no permissions. |
| 2     | Error state. |
| 3     | user1 added the device and invited user2 to become a family member; user2 has not accepted yet. |
| 4     | user1 invited user2 to become a family member; user2 has not accepted yet. |
| 5     | user1 added the device and invited user2 to become a family member; user2 scanned QR code but has not accepted yet. |
| 6     | user1 added the device and invited user2 to become a family member; user2 accepted the invitation and has permanent control rights. |
| 7     | user1 added the device and invited user2 to become a family member twice; user2 accepted the invitation and has permanent control rights. |
| 8     | user1 invited user2 to become a family member; user2 accepted the invitation and has permanent control rights. |
| 9     | user1 invited user2 to become a family member twice; user2 accepted the invitation and has permanent control rights. |
| 10    | user1 invited user2 to become a family member; user2 scanned QR code but has not accepted yet. |
| 11    | user1 added the device and invited user2 to become a family member; user2 accepted the invitation but later quit, revoking control rights. |
| 12    | user1 invited user2 to become a family member; user2 accepted the invitation but later quit, revoking control rights. |
| 13    | user1 invited user2 to become a family member twice; user2 scanned QR code but has not accepted yet. |
| 14    | user1 added the device and invited user2 to become a family member twice; user2 scanned QR code but has not accepted yet. |

## Divergent model
| State | Semantic Description |
|-------|----------------------|
| S0    | Initial state. |
| S1    | user1 added the device. |
| S2    | Error state. |
| S3    | user1 invited user2 to become a family member (invitation pending). |
| S4    | user1 invited user2, and user2 scanned the QR code (invitation pending acceptance). |
| S5    | user1 invited user2, user2 scanned and accepted the invitation; user2 is now a family member with control permissions. |
| S6    | user1 invited user2 twice, user2 scanned and accepted the second invitation; user2 is a family member with control permissions. |
| S7    | user1 added the device, invited user2 twice, user2 scanned and accepted the second invitation; user2 is a family member with control permissions. |
| S8    | user1 added the device, invited user2, user2 scanned and accepted; user2 is a family member with control permissions. |
| S9    | user1 invited user2, user2 scanned, accepted, and quit the home; user2 is no longer a family member. |
| S10   | user1 added the device, invited user2, and user2 scanned the QR code (invitation pending acceptance). |
| S11   | user1 added the device and invited user2 (invitation pending). |
| S12   | user1 added the device, invited user2, user2 scanned, accepted, and quit the home; user2 is no longer a family member. |
| S13   | user1 added the device, invited user2 twice, and user2 scanned the QR code (second invitation pending acceptance). |
| S14   | user1 invited user2 twice, and user2 scanned the QR code (second invitation pending acceptance). |
| S15   | user1 added the device, invited user2 twice, user2 scanned, accepted, and gained control permissions as a family member. |
| S16   | user1 added the device, invited user2 twice, user2 scanned, accepted, controlled the device, and user1 removed the device; user2 remains a family member. |
| S17   | user1 added the device, invited user2 twice, user2 scanned, accepted, controlled the device, user1 removed it, and user2 quit the home; user2 is no longer a family member. |
| S18   | user1 added the device, invited user2 twice, user2 scanned, accepted, controlled the device, user1 removed and re-added it, and user2 quit the home; user2 is no longer a family member. |
| S19   | user1 added the device, invited user2 twice, user2 scanned, accepted, controlled the device, and quit the home; user2 is no longer a family member. |
| S20   | user1 added the device, invited user2 twice, user2 scanned, accepted, controlled the device, quit the home, and scanned again (no family membership). |
| S21   | user1 added the device, invited user2 twice, user2 scanned, accepted, controlled the device, user1 removed and re-added it, user2 quit and scanned again (no family membership). |
| S22   | user1 added the device, invited user2 twice, user2 scanned, accepted, controlled the device, user1 removed it, user2 quit and scanned again (no family membership). |
| S23   | user1 added the device, invited user2 twice, user2 scanned, accepted, controlled the device, user1 removed it, user2 quit, scanned again, and user1 re-invited (pending acceptance). |
| S24   | user1 added the device, invited user2 twice, user2 scanned, accepted, controlled the device, user1 removed and re-added it, user2 quit, scanned again, and user1 re-invited (pending acceptance). |
| S25   | user1 added the device, invited user2 twice, user2 scanned, accepted, controlled the device, quit, scanned again, and user1 re-invited (pending acceptance). |
| S26   | user1 added the device, invited user2, user2 scanned, accepted, controlled the device, and user1 removed it; user2 remains a family member. |
| S27   | user1 added the device, invited user2, user2 scanned, accepted, controlled the device, user1 removed it, and user2 quit the home; user2 is no longer a family member. |
| S28   | user1 added the device, invited user2, user2 scanned, accepted, controlled the device, user1 removed and re-added it, and user2 quit the home; user2 is no longer a family member. |
| S29   | user1 added the device, invited user2, user2 scanned, accepted, controlled the device, user1 removed and re-added it; user2 remains a family member. |
| S30   | user1 added the device, invited user2, user2 scanned, accepted, and gained control permissions as a family member. |
| S31   | user1 added the device, invited user2, user2 scanned, accepted, controlled the device, and quit the home; user2 is no longer a family member. |
| S32   | user1 added the device, invited user2 twice, user2 scanned, accepted, controlled the device, user1 removed and re-added it; user2 remains a family member. |

# Bug Reports
## Base model
*   No issues found.

## Divergent model
*   **Vulnerability 1: Unauthorized Device Control After Quitting Home**  
    **Impact:** User2 can still control the device after quitting the home, despite no longer being a family member. This violates the principle that permissions should be revoked upon quitting. Multiple reports confirm this issue across various states, with successful or undetermined `DeviceControl` operations persisting after home departure.  
    **Problematic State(s):**  
        *   `s19`: User2 performed **DeviceControl**, received **Success**, transitioned to **State 19**, causing unauthorized device control.  
        *   `s20`: User2 performed **DeviceControl**, received **Success**, transitioned to **Same State**, causing unauthorized device control.  
        *   `s21`: User2 performed **DeviceControl**, received **Undetermined**, transitioned to **Same State**, potentially causing unauthorized device control.  
        *   `s25`: User2 performed **DeviceControl**, received **Success**, transitioned to **State 19**, demonstrating persistent control rights.  

*   **Vulnerability 2: Information Leakage via Differential Response**  
    **Impact:** User2 can infer system state changes through response variations when scanning QR codes or performing `DeviceControl` in different states. This allows attackers to deduce family membership status, invitation history, or other unauthorized information through error codes (`-2010`, `-2011`) or differential responses (`CLS_5`).  
    **Problematic State(s):**  
        *   `s5`: User2 performed **ScanQRCode**, received **Failed (error:-2010)**, transitioned to **State 5**, allowing inference of family membership status.  
        *   `s6`: User2 performed **ScanQRCode**, received **Failed (error:-2011)**, transitioned to **State 6**, allowing inference of invitation status.  
        *   `s18`, `s21`, `s24`: User2 performed **DeviceControl**, received **Undetermined (CLS_5)**, transitioned to **Same State**, causing differential inference possibility.  

*   **Vulnerability 3: Persistent Permissions After Device Removal**  
    **Impact:** User2 retains control permissions even after User1 removes and re-adds the device, violating the principle that permissions should be reset upon device removal. This creates inconsistent permission states where User2 maintains unauthorized control capabilities.  
    **Problematic State(s):**  
        *   `s16`: User1 removes device after User2 gained control permissions, but User2 remains a family member with undefined control capabilities.  
        *   `s26`: User1 removes device but User2 remains family member with failed `DeviceControl` attempts.  
        *   `s29`, `s32`: User2 performed **DeviceControl**, received **Success**, transitioned to **Same State**, causing persistent unauthorized control.  

*   **Vulnerability 4: Improper Permission Maintenance During Re-invitation**  
    **Impact:** When User2 quits and is re-invited, the system maintains inconsistent permission states that could allow unauthorized access during transitional periods. User2 can regain control permissions without proper re-authentication, bypassing security checks.  
    **Problematic State(s):**  
        *   `s22`: User2 performed **AcceptInvite**, received **Success**, transitioned to **State 26**, causing privilege escalation.  
        *   `s23`: User2 successfully **AcceptInvite** to transition to **State 16**, regaining control without re-verification.  
        *   `s24`: User2 performed **AcceptInvite**, received **Success**, transitioned to **State 32**, causing privilege escalation.  
        *   `s25`: User2 successfully **AcceptInvite** to transition to **State 15**, regaining control without re-verification.  

*   **Vulnerability 5: Undefined Behavior in Device Control**  
    **Impact:** Some `DeviceControl` operations return undetermined results due to lack of explicit success/failure indicators, potentially allowing unauthorized actions. This ambiguity in permission enforcement creates security risks.  
    **Problematic State(s):**  
        *   `s18`, `s21`, `s24`, `s28`: User2 performed **DeviceControl**, received **Undetermined**, transitioned to **Same State**, creating ambiguity about permission enforcement.  

*   **Vulnerability 6: Lack of Proper Session Termination**  
    **Impact:** Quitting the home doesn't fully clear all permission artifacts, leaving residual access possibilities. Some operations still return different responses than initial states, indicating incomplete session cleanup.  
    **Problematic State(s):**  
        *   `s17`, `s27`: After quitting, some operations still return different responses than initial states, indicating incomplete session cleanup.  

These vulnerabilities highlight critical security risks in permission management, information leakage, and state validation in the Divergent model. The issues span unauthorized access, improper permission revocation, and inconsistent state transitions, which could be exploited to maintain unauthorized control or infer sensitive system states.