# BTB Semantic
```json
{
    "local_user1_AddDevice": [
        [
            "Operation result: Success. Evidence: 'status':0,'msg':'ok'. Reason: The device addition flow completed successfully, indicated by 'status':0,'msg':'ok' responses."
        ]
    ],
    "local_user1_DeviceControl": [
        [
            "Operation result: Undetermined. Evidence: '2-packet UDP exchange with no explicit status codes'; 'no status code or success message'; 'No status code or success/failure pattern'; 'no success or error code'; 'two short UDP packets with no success/failure code'. Reason: The absence of any success or error codes in the minimal UDP traffic makes it impossible to confirm a definitive result"
        ]
    ],
    "local_user1_InviteToHome": [
        [
            "Operation result: Success. Evidence: 'invited' 'status=0'. Reason: The consensus indicates a successful invitation with no errors. An alternative viewpoint shows membership confirmation remains unclear."
        ],
        [
            "Operation result: Success. Evidence: 'familymember' includes user2 with 'type':1. Reason: The analyses confirm user2 is recognized as part of the family group with no errors."
        ]
    ],
    "local_user1_RemoveDevice": null,
    "local_user1_RemoveFromHome": [
        [
            "Operation result: Success. Evidence: 'delfamilymember'; 'error':0; 'msg':'ok'. Reason: The zero error code and 'ok' message indicate successful removal, though conflicting evidence suggests user2 remains listed."
        ]
    ],
    "local_user2_DeviceControl": [
        [
            "Operation result: Success. Evidence: 'status=0'. Reason: Majority consensus indicates successful device control with recurring 'status=0' and no error responses"
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            "Operation result: Undetermined. Evidence: ''. Reason: Majority consensus shows only brief UDP packets with no explicit success/fail code, making the outcome unclear"
        ]
    ],
    "remote_user1_DeviceControl": null,
    "remote_user2_AcceptInvite": [
        [
            "Operation result: Success. Evidence: ''. Reason: The acceptance request returned success codes with no contradictions, indicating the invitation was confirmed."
        ]
    ],
    "remote_user2_DeviceControl": [
        [
            ""
        ],
        [
            "Operation result: Success. Evidence: 'Response'. Reason: Multiple normal 'Response' messages with no error codes indicate successful device control"
        ],
        [
            ""
        ],
        [
            "Operation result: Failed. Evidence: 'ErrorResponse'. Reason: The device returned a reset indication with a negative status, preventing successful control"
        ]
    ],
    "remote_user2_QuitHome": [
        [
            "Operation result: Success. Evidence: 'status=0'. Reason: The /quitfamily call returned a success code."
        ],
        [
            "Operation result: Success. Evidence: 'status=0'. Reason: The /quitfamily call returned a success code."
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            "Operation result: Failed. Evidence: 'status=-30107'. Reason: The /quitfamily call returned an error code."
        ]
    ],
    "remote_user2_ScanQRCode": [
        [
            "Operation result: Success. Evidence: 'error=0'. Reason: The zero error code indicates a successful outcome"
        ],
        [
            "Operation result: Failed. Evidence: 'error=-2010'. Reason: The negative error code signifies a failed operation"
        ],
        [
            "Operation result: Failed. Evidence: 'error=-2011'. Reason: Another negative code affirms a failed operation"
        ]
    ]
}
```

# State Semantic
## Base model
| State | Semantic Description                                                                                         |
|-------|--------------------------------------------------------------------------------------------------------------|
| 0     | Initial state: no device added; user2 not invited.                                                          |
| 1     | user1 has added one device; user2 is not invited and has no control.                                        |
| 2     | Error state.                                                                                                |
| 3     | user1 has added one device; user2 is invited but has not accepted.                                          |
| 4     | No device added; user2 is invited but has not accepted.                                                     |
| 5     | user1 has added one device; user2 scanned the QR code but has not accepted.                                 |
| 6     | user1 has added one device; user2 accepted the invite as family and has permanent control.                  |
| 7     | user1 has added one device; user2 accepted multiple (re)invites as family and has permanent control.        |
| 8     | No device added; user2 accepted the family invite and retains permanent control for future devices.         |
| 9     | No device added; user2 accepted multiple invites and is a family member with permanent control.             |
| 10    | No device added; user2 scanned the QR code but has not accepted.                                            |
| 11    | user1 has added one device; user2 was a family member but quit and lost all control.                        |
| 12    | No device added; user2 was a family member but quit, losing all control.                                    |
| 13    | No device added; user2 is re-invited multiple times but has not accepted.                                   |
| 14    | user1 has added one device; user2 is re-invited (possibly multiple times) but has not accepted.            |

## Divergent model
| State | Semantic Description |
|-------|----------------------|
| 0 | Initial state. |
| 1 | user1 has added one device. user2 is not invited and has no control. |
| 2 | Error state. |
| 3 | No device has been added. user2 is invited but has not accepted membership. |
| 4 | No device has been added. user2 scanned the invitation but has not accepted membership. |
| 5 | No device has been added. user2 accepted the invitation and is now a family member with permanent rights. |
| 6 | No device has been added. user2 remains a family member (multiple invites had no effect). |
| 7 | user1 has added one device. user2 is a family member with permanent control over that device. |
| 8 | user1 has added one device. user2 is a family member with permanent control rights. |
| 9 | No device is added. user2 was a family member but quit and is no longer in the family. |
| 10 | user1 has added one device. user2 scanned the invitation but has not accepted membership. |
| 11 | user1 has added one device. user2 is invited but has not accepted membership. |
| 12 | user1 has added one device. user2 was a family member but quit, losing membership and control. |
| 13 | user1 has added one device. user2 scanned the code but has not accepted membership. |
| 14 | No device has been added. user2 scanned the invitation multiple times but has not accepted membership. |
| 15 | user1 has added one device. user2 is a family member actively controlling the device. |
| 16 | The device was removed. user2 remains a family member with permanent rights if re-added. |
| 17 | No device is present. user2 quit the home and is no longer a family member. |
| 18 | user1 has re-added the device (second addition). user2 quit the home and is no longer a family member. |
| 19 | user1 has one device. user2 quit the home and is no longer a family member. |
| 20 | user1 has one device. user2 quit the home and remains outside the family; scanning the code did not restore membership. |
| 21 | user1 has added the device twice. user2 quit the home and scanned a code but remains outside the family. |
| 22 | No device is present. user2 quit the home, scanned a code, but remains outside the family without control. |
| 23 | No device is present. user2 was re-invited after quitting but has not accepted membership. |
| 24 | user1 has re-added the device (second addition). user2 has been re-invited but has not accepted membership. |
| 25 | user1 has one device. user2 quit the home earlier, was re-invited, but has not accepted membership. |
| 26 | The device was removed, but user2 remains a family member with permanent rights if re-added. |
| 27 | No device is present. user2 quit the home and is no longer a family member. |
| 28 | user1 has re-added the device (second addition). user2 quit the home and is no longer a family member. |
| 29 | user1 has re-added the device (second addition). user2 remains a family member with permanent control rights. |
| 30 | user1 has one device. user2 is a family member actively controlling the device. |
| 31 | user1 has one device. user2 quit the home and is no longer a family member. |
| 32 | user1 has re-added the device (second addition). user2 remains a family member with control rights. |

# Bug Reports
## Base model
No issues found.

## Divergent model
* **Vulnerability 1: Ex-member retains unauthorized device control**  
* **Impact:**  
  Across all five reports, it is consistently shown that once user2 quits the home (thus losing membership and any direct sharing rights), they should no longer be able to control user1’s device. However, the state machine indicates multiple transitions in which user2, despite having no valid membership, can still successfully perform local device-control operations or at least does not receive a clear denial. This behavior violates the intended permission model and compromises the integrity and availability of the device, enabling an unauthorized user to potentially continue issuing commands and interfering with user1’s device operations.

* **Problematic State(s):**  
  • `s18`: Performed **user2|local|DeviceControl**, received **Undetermined** outcome (no explicit denial). Since user2 is outside the family, this ambiguity poses a risk of unauthorized control.  

  • `s19`: Performed **user2|local|DeviceControl (CLS_0)**, received **Success**, causing unauthorized device control by an ex-member.  

  • `s20 → s19`: Performed **user2|local|DeviceControl (CLS_0)**, received **Success**, transitioning to s19 while user2 remains outside the family, enabling continued control.  

  • `s21`: Performed **user2|local|DeviceControl** with no explicit failure response (Undetermined). Again, user2 is not a member, so this raises the risk of unauthorized access.  

  • `s24`: Similarly, user2 performed **user2|local|DeviceControl** with an Undetermined outcome, indicating a possible lack of rejection for an ex-member.  

  • `s25 → s19`: Performed **user2|local|DeviceControl (CLS_0)**, received **Success**, transitioning to s19. Although user2 was re-invited, membership was never re-accepted, so control remains unauthorized.  

  • `s31`: Performed **user2|local|DeviceControl (CLS_0)**, received **Success**, staying in s31 while user2 is still a non-member, indicating ongoing unauthorized device access.  