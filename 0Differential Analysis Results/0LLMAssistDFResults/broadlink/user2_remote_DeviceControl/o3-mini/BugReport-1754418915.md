# BTB Semantic
```json
{
    "local_user1_AddDevice": [
        [
            "Operation result: Success. Evidence: ''msg':'ok', 'status':0' ''. Reason: The recurring explicit success indicators, notably the consistent inclusion of 'msg':'ok' (and in most cases 'status':0), provide clear confirmation that the device addition operation was executed successfully."
        ]
    ],
    "local_user1_DeviceControl": [
        [
            "Operation result: Undetermined. Evidence: 'user1_local'. Reason: The majority of analysis reveals that the packet containing 'user1_local' presents the expected header yet lacks explicit success or error status codes and bidirectional confirmation. Although a minority of reports noted bidirectional exchanges involving device_0, the common evidence across most reports does not provide definitive control feedback."
        ]
    ],
    "local_user1_InviteToHome": [
        [
            "Operation result: Success. Evidence: '/appsync/group/member/invited/reqqrcode'. Reason: The responses consistently reveal the invitation endpoint with error:0, status:0 and msg:'ok', confirming a successful invite operation."
        ],
        [
            "Operation result: Success. Evidence: '/appsync/group/member/invited/reqqrcode'. Reason: The data shows the invitation endpoint returning error:0 and a valid invite message, with additional membership details reinforcing the successful invite."
        ]
    ],
    "local_user1_RemoveDevice": null,
    "local_user1_RemoveFromHome": [
        [
            "Operation result: Success. Evidence: 'msg':'ok'. Reason: The majority of API responses explicitly confirm removal by returning 'msg':'ok' with associated success indicators (error:0, status changes), while a single report indicating a persisting user likely represents an outlier verification anomaly."
        ]
    ],
    "local_user2_DeviceControl": [
        [
            "Operation result: Success. Evidence: 'Response'. Reason: The control command execution is confirmed by repeated instances of 'Response' in the HTTP POST flows, indicating bidirectional acknowledgment across the reports."
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            "Operation result: Success. Evidence: 'UDP'. Reason: Sustained UDP communications are evident, with the consistent presence of UDP traffic confirming a continuous control operation despite an isolated report with an undetermined outcome."
        ]
    ],
    "remote_user1_DeviceControl": null,
    "remote_user2_AcceptInvite": [
        [
            "Operation result: Success. Evidence: ''invited/joinfamily' with 'msg':'ok''. Reason: The join family packet clearly demonstrates invite acceptance through the consistent appearance of the 'invited/joinfamily' endpoint and the 'msg':'ok' flag, indicating a successful operation response."
        ]
    ],
    "remote_user2_DeviceControl": [
        [
            ""
        ],
        [
            "Operation result: Success. Evidence: '**Response**'. Reason: The majority consensus indicates that packets carry a 'Response' header without error codes, signifying a successfully completed control operation."
        ],
        [
            ""
        ],
        [
            "Operation result: Failed. Evidence: '**ErrorResponse**'. Reason: The consistent presence of an explicit error response, marked by a 'device reset, please rebind' message and an error status, confirms an operation failure."
        ]
    ],
    "remote_user2_QuitHome": [
        [
            "Operation result: Success. Evidence: ''msg':'ok''. Reason: The explicit quitfamily responses all include the fragment ''msg':'ok'', confirming a successful operation despite any subsequent unrelated error packets."
        ],
        [
            "Operation result: Success. Evidence: ''msg':'ok''. Reason: The quitfamily API returned a clear success response containing ''msg':'ok'', which underlines the effectiveness of the quit action even in the context of additional device control responses."
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            "Operation result: Failed. Evidence: ''status':-30107''. Reason: The quitfamily endpoint responses consistently show a negative status (-30107), directly indicating that the quit operation failed."
        ]
    ],
    "remote_user2_ScanQRCode": [
        [
            "Operation result: Success. Evidence: 'msg':'ok'. Reason: The payload details consistently reflect a successful operation with a clear 'ok' message as indicated in every report."
        ],
        [
            "Operation result: Failed. Evidence: 'error':-2010. Reason: The payload details uniformly include an error field with value -2010, confirming the operation failed."
        ],
        [
            "Operation result: Failed. Evidence: 'error':-2011. Reason: The payload details consistently show an error field with value -2011, confirming the failure outcome."
        ]
    ]
}
```

# State Semantic
## Base model
| State | Semantic Description |
|-------|----------------------|
| s0 | Initial state. |
| s1 | User1 added the device once (addition count = 1) without issuing any invitation; user2 remains without invitation and without control permissions. |
| s2 | Error state. |
| s3 | User1 added the device once and issued an invitation; user2 is invited but pending manual acceptance and thus holds no control rights. |
| s4 | User1 initiated an invitation without adding a device; user2 is invited (pending acceptance) and has no control rights. |
| s5 | User1 added the device once and sent an invitation; user2 scanned the QR code but has not completed manual acceptance, so no control rights are granted. |
| s6 | User1 added the device once and sent an invitation; user2 scanned the QR code and accepted, thereby becoming a family member with permanent control rights. |
| s7 | User1 added the device once and issued multiple invitations; user2 scanned the QR code and accepted a later invitation, thereby becoming a family member with permanent control rights. |
| s8 | User1 issued an invitation without adding a device; user2 scanned the QR code and accepted, thereby becoming a family member with permanent control rights. |
| s9 | User1 issued multiple invitations without adding a device; user2 scanned the QR code and accepted, thereby becoming a family member with permanent control rights. |
| s10 | User1 issued an invitation and user2 scanned the QR code, but without completing manual acceptance, the invitation remains pending and no control rights are granted. |
| s11 | User1 added the device once and sent an invitation; user2 scanned and accepted the invitation but later quit, thereby revoking family membership and control rights. |
| s12 | User1 issued an invitation without adding a device; user2 accepted the invitation but subsequently quit, resulting in the loss of family membership and control rights. |
| s13 | User1 sent multiple invitations; user2 scanned the QR code but did not accept any invitation, leaving the invitation pending and no control rights granted. |
| s14 | User1 added the device once and sent multiple invitations; user2 scanned the QR code but did not accept any invitation, so the invitation remains pending and no control rights are assigned. |

## Divergent model
| State | Semantic Description |
|-------|----------------------|
| s0 | Initial state: no device is added and no invitation has been sent; user2 holds no permissions. |
| s1 | user1 added the device once (count = 1) with no invitation issued; as a result, user2 has no permissions. |
| s2 | Error state. |
| s3 | user1 sent a family membership invitation (with no device added); user2 has not yet responded. |
| s4 | user1 sent an invitation and user2 scanned the QR code, but no manual acceptance was completed, so no control is granted. |
| s5 | user1 invited user2 and user2 accepted the invitation, establishing family membership with permanent control rights; no device has been added. |
| s6 | user1 issued a redundant invitation and user2 accepted the later invite, confirming family membership with permanent rights; no device is present. |
| s7 | user1 added the device (count = 1) and then invited user2; after scanning and accepting the invitation, user2 gains permanent family membership and control rights. |
| s8 | user1 added the device (count = 1) and invited user2, who scanned and accepted the invitation to become a family member with permanent control rights. |
| s9 | user1 invited user2 and user2 accepted and exercised control, but then user2 quit the family membership, thereby revoking control rights. |
| s10 | user1 added the device (count = 1) and sent an invitation; user2 scanned the QR code but did not manually accept, leaving permission pending. |
| s11 | user1 added the device (count = 1) and initiated an invitation; with no further response from user2, no permission is granted. |
| s12 | user1 added the device (count = 1) and invited user2, who accepted but later quit—thus revoking the family membership and control rights. |
| s13 | user1 added the device (count = 1) and initiated the invitation flow (including a QR scan) and then reissued the invitation; user2’s acceptance remains pending. |
| s14 | user1 did not add a device but sent multiple (consecutive) invitations; user2 scanned the QR code but did not accept, so no permissions are granted. |
| s15 | user1 added the device (count = 1) and invited user2; after scanning and accepting, user2 actively controls the device as a confirmed family member with permanent rights. |
| s16 | user1 added the device and invited user2, who accepted and controlled it; subsequently, user1 removed the device, yet user2 retains permanent family membership and control rights. |
| s17 | user1 added the device and invited user2, who accepted and controlled it; after user1 removed the device, user2 quit, resulting in revocation of family membership and control rights. |
| s18 | user1 added the device and invited user2, who accepted and controlled it; later, user1 removed and re-added the device, but user2 subsequently quit, causing loss of control. |
| s19 | user1 added the device (count = 1) and invited user2; although user2 accepted and controlled it, a subsequent quit by user2 revokes the family membership and control rights. |
| s20 | user1 added the device (count = 1) and invited user2; after user2 accepted and controlled the device, they later quit and only scanned the QR code without re-accepting, leaving permission revoked. |
| s21 | user1 added the device (count = 1), then removed and re-added it after user2 had accepted the invitation; later, user2 quit and merely scanned the QR code, resulting in loss of control rights. |
| s22 | user1 added the device (count = 1) and invited user2; following acceptance and control, the device was removed and user2 quit—subsequent QR scanning did not restore permission. |
| s23 | user1 added the device (count = 1) and invited user2, who accepted and controlled it; after device removal and a subsequent quit (with a QR scan), user1 reissued an invitation, leaving user2’s status pending. |
| s24 | user1 added the device (count = 1), invited user2 who accepted and controlled it, then removed and re-added the device; later, user2 quit and only scanned upon re-invitation, so the invitation remains pending. |
| s25 | user1 added the device (count = 1) and invited user2; although user2 accepted and controlled it, a subsequent quit followed by only a QR scan during re-invitation leaves family membership unconfirmed. |
| s26 | user1 added the device and invited user2; after user2 accepted and controlled it, user1 removed the device, but user2 retains permanent family membership and associated control rights. |
| s27 | user1 added the device and invited user2; user2 accepted and controlled it, but after user1 removed the device, user2 quit—resulting in revocation of both family membership and control rights. |
| s28 | user1 added the device (count = 1) and invited user2, who accepted and controlled it; following device removal and re-addition, user2 later quit, thereby revoking permanent control rights. |
| s29 | user1 added the device (count = 1) and invited user2; after user2 accepted and controlled it, and despite a device removal and re-addition, user2 remains a family member with active control rights. |
| s30 | user1 added the device (count = 1) and invited user2; by scanning, accepting, and controlling the device, user2 secures permanent family membership and control rights. |
| s31 | user1 added the device (count = 1) and invited user2; although user2 accepted and controlled it initially, a subsequent quit revokes the family membership and control rights. |
| s32 | user1 added the device and sent duplicate invitations; user2 scanned, accepted, and controlled it, and even after the device was removed and re-added (active count = 1), user2’s permanent family membership and control rights remain. |

# Bug Reports
## Base model
* No issues found.

## Divergent model
* **Vulnerability 1: Unauthorized Remote DeviceControl Success Despite Revoked or Unconfirmed Membership**  
  **Impact:** In multiple divergent states, the system erroneously returns a “Success” response to user2’s remote DeviceControl operations even after the state semantics indicate that family membership and control rights have been revoked or remain unconfirmed. This improper authorization check means that an attacker (or revoked user) may exploit retained or historical parameters from previous legitimate interactions to continue controlling the device. As a result, the integrity of access control is undermined and may further enable differential inference of system states.  
  **Problematic State(s):**
    * `s19`: Performed remote DeviceControl by user2 after a quit operation (membership revoked), received a “Success” response (Symbol: CLS_1), causing unauthorized control despite revoked privileges.
    * `s25`: Performed remote DeviceControl by user2 when the family membership remains unconfirmed (following a subsequent quit and QR re‑invitation), received a “Success” response, thereby granting control when it should have been denied.
    * `s31`: Performed remote DeviceControl by user2 after membership revocation via quit, received a “Success” response, leading to continued unauthorized access.

* **Vulnerability 2: Differential Information Leakage via Inconsistent Error Responses**  
  **Impact:** In certain divergent states, differences in response behavior during remote DeviceControl operations allow an attacker to infer sensitive internal system state information. Specifically, while some unauthorized requests return a silent or empty response, others yield explicit error messages (e.g., “device reset, please rebind” with a distinct symbol), inadvertently exposing nuances of device status and operational history. This inconsistent error messaging can be exploited to gather intelligence on internal state transitions and configuration details that should remain concealed.  
  **Problematic State(s):**
    * `s18`: Performed remote DeviceControl by user2, received an explicit error message (“device reset, please rebind”, Symbol: CLS_3) instead of a uniform failure response, thereby leaking information about internal state transitions.
    * `s21`: Performed remote DeviceControl by user2, received a differential explicit error response compared with other failure states, causing an attacker to infer additional internal device status details.