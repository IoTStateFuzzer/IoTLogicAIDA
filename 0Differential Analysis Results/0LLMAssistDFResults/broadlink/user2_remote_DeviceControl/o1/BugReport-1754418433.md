# BTB Semantic
```json
{
    "local_user1_AddDevice": [
        [
            "Operation result: Success. Evidence: 'status':0'; 'msg':'ok'. Reason: 'status':0' and 'msg':'ok' indicate a successful addition with no error codes"
        ]
    ],
    "local_user1_DeviceControl": [
        [
            "Operation result: Undetermined. Evidence: 'no success or error codes'; 'short UDP flow'. Reason: There are no explicit success or failure indicators in the limited UDP exchange, leaving the final outcome unconfirmed."
        ]
    ],
    "local_user1_InviteToHome": [
        [
            "Operation result: Success. Evidence: 'invited' with 'error=0'. Reason: Invitation requests returned success codes with no errors."
        ],
        [
            "Operation result: Success. Evidence: 'user2'. Reason: The updated membership confirms user2 was successfully added with no errors."
        ]
    ],
    "local_user1_RemoveDevice": null,
    "local_user1_RemoveFromHome": [
        [
            "Operation result: Success. Evidence: 'error=0','status=0','msg=ok'. Reason: The removal request returned these indicators, confirming a successful operation."
        ]
    ],
    "local_user2_DeviceControl": [
        [
            "Operation result: Success. Evidence: 'status':0. Reason: A zero status code indicates successful operation"
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            "Operation result: Undetermined. Evidence: ''. Reason: No conclusive codes or error messages; a minority indicates normal operation, but overall outcome remains uncertain"
        ]
    ],
    "remote_user1_DeviceControl": null,
    "remote_user2_AcceptInvite": [
        [
            "Operation result: Success. Evidence: 'invited/joinfamily' with 'error=0'. Reason: The invitation acceptance was confirmed by a successful response indicating error=0."
        ]
    ],
    "remote_user2_DeviceControl": [
        [
            ""
        ],
        [
            "Operation result: Success. Evidence: 'Response'. Reason: Repeated 'Response' messages with no error codes, indicating successful control."
        ],
        [
            ""
        ],
        [
            "Operation result: Failed. Evidence: 'ErrorResponse' with 'status':-7. Reason: The device reset message indicates a negative code requiring rebind and control failure."
        ]
    ],
    "remote_user2_QuitHome": [
        [
            "Operation result: Success. Evidence: 'status=0','msg':'ok'. Reason: The request returned a 0 status code and an 'ok' message, indicating a successful quit operation."
        ],
        [
            "Operation result: Success. Evidence: 'status=0','msg':'ok'. Reason: The request returned a 0 status code and an 'ok' message, indicating a successful quit operation."
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            "Operation result: Failed. Evidence: 'status=-30107'. Reason: The request returned a negative status code, indicating that the quit operation failed."
        ]
    ],
    "remote_user2_ScanQRCode": [
        [
            "Operation result: Success. Evidence: 'error=0'. Reason: The zero error code indicates a successful operation"
        ],
        [
            "Operation result: Failed. Evidence: 'error=-2010'. Reason: The negative error code indicates the operation failed"
        ],
        [
            "Operation result: Failed. Evidence: 'error=-2011'. Reason: The negative error code indicates the operation was not successful"
        ]
    ]
}
```

# State Semantic
## Base model
| State | Semantic Description |
|-------|----------------------|
| 0     | Initial state. |
| 1     | user1 has added the device once; user2 is not invited and has no control. |
| 2     | Error state. |
| 3     | user1 has added the device once; user2 is invited but has not accepted. |
| 4     | No device is added; user2 is invited but has not accepted. |
| 5     | user1 has added the device once; user2 scanned the invitation code but has not accepted. |
| 6     | user1 has added the device once; user2 accepted the family invitation and has permanent control rights. |
| 7     | user1 has added the device once; after repeated invitations, user2 ultimately accepted and is a family member with permanent control rights. |
| 8     | No device is added; user2 accepted the family invitation and now has permanent control rights over future devices. |
| 9     | No device is added; after repeated invitations, user2 accepted and is a family member with permanent control rights over future devices. |
| 10    | No device is added; user2 scanned the invitation code but has not accepted. |
| 11    | user1 has added the device once; user2 joined as a family member but then quit, so has no control now. |
| 12    | No device is added; user2 joined as a family member but then quit, and now has no control. |
| 13    | No device is added; user2 remains invited but has not accepted the repeated invitation. |
| 14    | user1 has added the device once; user2 remains invited but has not accepted the repeated invitation. |

## Divergent model
| State | Semantic Description |
|-------|----------------------|
| 0  | Initial state. |
| 1  | user1 has added the device once; user2 is not invited and has no control. |
| 2  | Error state. |
| 3  | No device added; user2 is invited to family membership but has not accepted yet. |
| 4  | No device added; user2 scanned the invitation code but has not accepted membership. |
| 5  | No device added; user2 has accepted the family invitation and is now a family member with permanent control rights. |
| 6  | No device added; user2 accepted family membership after multiple invites, holding permanent control rights. |
| 7  | user1 has added one device; user2 is a family member with permanent control rights. |
| 8  | user1 has added one device; user2 is a family member with permanent control rights. |
| 9  | No device added; user2 was a family member but quit the home and lost membership. |
| 10 | user1 has one device; user2 is invited but has not accepted membership (no control). |
| 11 | user1 has one device; user2 is invited but has not accepted membership. |
| 12 | user1 has one device; user2 was a family member but quit, thus no membership or control. |
| 13 | user1 has one device; user2 was invited (possibly multiple times) but has not accepted membership. |
| 14 | No device added; user2 was invited multiple times but has not accepted membership. |
| 15 | user1 has one device; user2 is a family member actively controlling the device. |
| 16 | user1 removed the only device; user2 remains a family member but has no device to control. |
| 17 | No devices remain; user2 quit the family and no longer holds membership. |
| 18 | user1 removed and re-added one device; user2 quit the family and no longer has membership. |
| 19 | user1 has one device; user2 was a family member but quit, so user2 has no membership or control. |
| 20 | user1 has one device; user2 quit the family, scanned a code afterward, and remains without membership or control. |
| 21 | user1 removed then re-added the device (one device); user2 quit the family, scanned again, but still has no membership. |
| 22 | No device is present; user2 quit the family and scanning the code again does not restore membership. |
| 23 | No device present; user2 was re-invited after quitting but has not accepted membership. |
| 24 | user1 removed and re-added one device; user2 quit the family, was re-invited, but has not accepted membership. |
| 25 | user1 has one device; user2 quit the family and was re-invited but has not accepted membership. |
| 26 | The single device was removed; user2 remains a family member with no device to control. |
| 27 | No device present; user2 was a family member but quit, so user2 has no membership. |
| 28 | user1 re-added one device; user2 quit the family and has no membership. |
| 29 | user1 re-added the device; user2 remains a family member with permanent control rights. |
| 30 | user1 has one device; user2 is a family member with active control. |
| 31 | user1 has one device; user2 was a family member but quit, so user2 has no membership or control. |
| 32 | The device was removed and re-added; user2 remains a family member with full control rights. |

# Bug Reports
## Base model
No issues found.

## Divergent model
* **Vulnerability 1: Unauthorized remote device control by user2 after membership revocation**  
* **Impact:**  
  Even though user2 “quit” the family (and thus should have no valid membership or control rights), all five reports confirm that user2 can still perform remote device-control actions successfully. This compromises the authorization model and undermines both confidentiality and integrity: user2, despite having ostensibly lost all permissions, can continue to operate the device (CWE-284/Missing Access Controls, CWE-862/Missing Authorization, and CWE-863/Incorrect Authorization).

* **Problematic State(s):**
  * `s19`: Performed user2|remote|DeviceControl / Symbol: CLS_1, received “Success,” causing unauthorized control even though state semantics show user2 has no membership or control.  
  * `s20`: Performed user2|remote|DeviceControl / Symbol: CLS_1, received “Success,” transitioning to s19, again allowing unauthorized operation.  
  * `s25`: Performed user2|remote|DeviceControl / Symbol: CLS_1, received “Success,” transitioning to s19, allowing user2 to operate the device without valid membership.  
  * `s31`: Performed user2|remote|DeviceControl / Symbol: CLS_1, received “Success,” remaining in s31, enabling user2 to continue unauthorized device control.