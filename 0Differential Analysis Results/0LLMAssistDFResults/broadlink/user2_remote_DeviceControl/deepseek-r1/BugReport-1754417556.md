# BTB Semantic
```json
{
    "local_user1_AddDevice": [
        [
            "Operation result: Success. Evidence: 'POST|/appsync/group/dev/manage'; ''error':0,'status':0,'msg':'ok''. Reason: Device management endpoint responses confirm operation success with explicit indicators (status:0, error:0, 'ok' message). Absence of direct 'AddDevice' keywords in payloads doesn't override explicit success markers."
        ]
    ],
    "local_user1_DeviceControl": [
        [
            "Operation result: Undetermined. Evidence: 'Bidirectional UDP exchange (2 packets)'; 'pattern analysis'; 'bidirectional UDP flow'; 'UDP payload abstraction (Abs_Len)'. Reason: Bidirectional UDP traffic was observed, but confirmation requires explicit payload indicators of device control success. No status codes, control keywords, or operational context were found in packet contents. Minimal packet exchange (2 packets) provides only connectivity evidence despite bidirectional patterns. While traffic characteristics suggest possible command-response interaction, payloads contain only length markers or abstracted data without error/confirmation semantics, preventing definitive verification of control operation success."
        ]
    ],
    "local_user1_InviteToHome": [
        [
            "Operation result: Success. Evidence: 'error':0; 'status':0; 'msg':'ok'. Reason: Payload indicators (error:0, status:0, msg:'ok') confirm successful QR code generation at /appsync/group/member/invited/reqqrcode endpoint for invitation request."
        ],
        [
            "Operation result: Success. Evidence: 'error':0; 'status':0; 'msg':'ok'. Reason: Identical payload success indicators (error:0, status:0, msg:'ok') demonstrate consistent operational success at invite QR code endpoint despite parametric variations."
        ]
    ],
    "local_user1_RemoveDevice": null,
    "local_user1_RemoveFromHome": [
        [
            "Operation result: Success. Evidence: 'error':0,'status':0,'msg':'ok'. Reason: Deletion API response confirms success with status:0 and 'ok' message, directly correlating to removal command execution at critical endpoint despite no immediate list change."
        ]
    ],
    "local_user2_DeviceControl": [
        [
            "Operation result: Success. Evidence: 'sustained bidirectional traffic'; 'UDP exchange between device_0 and user2_local'; 'Bidirectional UDP flow (device_0 \u2194 user2_local)'. Reason: Sustained bidirectional UDP traffic between device_0 and user2_local without termination signals or error indicators, with complementary event response headers confirming protocol-level command execution."
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            "Operation result: Success. Evidence: 'UDP exchange between device_0 and user2_local'. Reason: Persisting UDP exchange pattern without termination or error signals, establishing session continuity despite minimal packet volume and lack of explicit control markers."
        ]
    ],
    "remote_user1_DeviceControl": null,
    "remote_user2_AcceptInvite": [
        [
            "Operation result: Success. Evidence: '/appsync/group/member/invited/joinfamily|||||FPSPER{'error':0,'status':0,'msg':'ok'}'. Reason: HTTP POST to invitation acceptance endpoint with explicit success indicators (status:0, error:0, 'ok' message) confirms successful family group join operation."
        ]
    ],
    "remote_user2_DeviceControl": [
        [
            ""
        ],
        [
            "Operation result: Success. Evidence: 'POST /device/control/v2/sdkcontrol' + 'name':'Response' + alternating 'pwr' values (0/1). Reason: Control endpoint responses with HTTP POST method and alternating power state values confirm command acceptance through payload patterns, despite encrypted content obscuring full transaction details."
        ],
        [
            ""
        ],
        [
            "Operation result: Failed. Evidence: 'name':'ErrorResponse' + 'status:-7' + 'message':'device reset, please rebind'. Reason: Explicit error response with negative status code (-7) and device reset notification confirms critical authentication failure requiring reinitialization."
        ]
    ],
    "remote_user2_QuitHome": [
        [
            "Operation result: Success. Evidence: '/appsync/group/member/quitfamily|||||FPSPER{'error':0,'status':0,'msg':'ok'}'. Reason: HTTP 200 equivalent (status:0) with 'ok' message confirms successful quitfamily operation through appsync endpoint."
        ],
        [
            "Operation result: Success. Evidence: '/appsync/group/member/quitfamily|||||FPSPER{'error':0,'status':0,'msg':'ok'}'. Reason: Core API response (status=0, error=0) validates quitfamily success, independent of subsequent device state changes."
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            ""
        ],
        [
            "Operation result: Failed. Evidence: '/appsync/group/member/quitfamily|||||FPSPER{'status':-30107,'msg':'\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd'}'. Reason: Negative status code -30107 with encoded error message indicates system-level rejection of quitfamily request."
        ]
    ],
    "remote_user2_ScanQRCode": [
        [
            "Operation result: Success. Evidence: 'error':0,'status':0,'msg':'ok'. Reason: Consistent success confirmation through HTTP 200-equivalent status codes (0) with explicit 'ok' message in payload."
        ],
        [
            "Operation result: Failed. Evidence: 'error':-2010,'status':-2010. Reason: System-specific authentication failure indicated by negative error code -2010 in payload response."
        ],
        [
            "Operation result: Failed. Evidence: 'error':-2011,'status':-2011. Reason: Sequential error code -2011 confirms credential expiration or invalid permissions for QR code operation."
        ]
    ]
}
```

# State Semantic
## Base model


| State | Semantic Description |
|-------|----------------------|
| 0     | Initial state. |
| 1     | user1 added the device once; user2 is not a family member and has no permissions. |
| 2     | Error state. |
| 3     | user1 added the device once and invited user2 as a family member; user2 has not accepted. |
| 4     | user1 has not added any device; user2 is invited as a family member but has not accepted. |
| 5     | user1 added the device once; user2 scanned the QR code but has not accepted the family invitation. |
| 6     | user1 added the device once; user2 is a family member with permanent control permissions. |
| 7     | user1 added the device once; user2 is a family member with permanent control permissions. |
| 8     | user1 has not added any device; user2 is a family member with permanent control permissions. |
| 9     | user1 has not added any device; user2 is a family member with permanent control permissions. |
| 10    | user1 has not added any device; user2 is invited as a family member but has not accepted. |
| 11    | user1 added the device once; user2 quit the family and lost control permissions. |
| 12    | user1 has not added any device; user2 quit the family and has no permissions. |
| 13    | user1 has not added any device; user2 is invited as a family member but has not accepted. |
| 14    | user1 added the device once; user2 is invited as a family member but has not accepted. |

## Divergent model


| State | Semantic Description |
|-------|----------------------|
| S0    | Initial state. |
| S1    | user1 added the device once; user2 has not been invited. |
| S2    | Error state. |
| S3    | user1 has not added the device; user2 is invited as a family member but has not accepted. |
| S4    | user1 has not added the device; user2 scanned the invitation but has not accepted. |
| S5    | user1 has not added the device; user2 is a family member with permanent control rights. |
| S6    | user1 has not added the device; user2 is a family member with control rights. |
| S7    | user1 added the device once; user2 is a family member with control rights. |
| S8    | user1 added the device once; user2 is a family member with control rights. |
| S9    | user2 quit the family, revoking all permissions; user1 has not added the device. |
| S10   | user1 added the device once; user2 scanned the invitation but has not accepted. |
| S11   | user1 added the device once; user2 is invited as a family member but has not accepted. |
| S12   | user1 added the device once; user2 quit the family, losing permissions. |
| S13   | user1 added the device once; user2 scanned the invitation but has not accepted. |
| S14   | user1 has not added the device; user2 scanned the invitation but has not accepted. |
| S15   | user1 added the device once; user2 is a family member with active control rights. |
| S16   | user1 removed the device; user2 remains a family member but has no device to control. |
| S17   | user1 removed the device; user2 quit the family, losing all permissions. |
| S18   | user1 re-added the device; user2 quit the family and has no permissions. |
| S19   | user1 added the device once; user2 quit the family, losing permissions. |
| S20   | user1 added the device once; user2 is not a family member and has no permissions. |
| S21   | user1 re-added the device; user2 is not a family member and has no permissions. |
| S22   | user1 removed the device; user2 is not a family member and has no permissions. |
| S23   | user1 re-invited user2 as a family member; user2 has not accepted. |
| S24   | user1 re-added the device; user2 is re-invited as a family member but has not accepted. |
| S25   | user1 added the device once; user2 is re-invited as a family member but has not accepted. |
| S26   | user1 removed the device; user2 remains a family member but has no device to control. |
| S27   | user1 removed the device; user2 quit the family, losing all permissions. |
| S28   | user1 re-added the device; user2 quit the family and has no permissions. |
| S29   | user1 re-added the device; user2 remains a family member with control rights. |
| S30   | user1 added the device once; user2 is a family member with active control rights. |
| S31   | user1 added the device once; user2 quit the family, losing permissions. |
| S32   | user1 re-added the device; user2 remains a family member with control rights. |

# Bug Reports
## Base model
*   No issues found.

## Divergent model
*   **Vulnerability 1: Unauthorized Device Control in Multiple States**  
*   **Impact:** Allows unauthorized device control by non-family members or revoked family members through residual permissions, invitation exploits, and failure to revoke access. This compromises system integrity by enabling device manipulation without valid authorization, including scenarios where users retain control after quitting the family, execute commands without membership, or escalate privileges during pending re-invitations.  
*   **Problematic State(s):**  
    *   `S19`: Performed **user2|remote|DeviceControl**, received **CLS_1 (Success)**, transitioned to **State S19**, causing **persistent unauthorized control after quitting the family**.  
    *   `S20`: Performed **user2|remote|DeviceControl**, received **CLS_1 (Success)**, transitioned to **State S19**, causing **device control by non-family member without valid permissions**.  
    *   `S25`: Performed **user2|remote|DeviceControl**, received **CLS_1 (Success)**, transitioned to **State S19**, causing **privilege escalation via unaccepted re-invitation**.  
    *   `S31`: Performed **user2|remote|DeviceControl**, received **CLS_1 (Success)**, transitioned to **State S31**, causing **continued access after explicit permission revocation**.  

*   **Vulnerability 2: State Inference via Error Code Patterns**  
*   **Impact:** Differential error responses leak system state information, enabling attackers to infer device lifecycle events (e.g., resets) or authentication failure types (e.g., expired credentials vs. invalid permissions). This violates confidentiality through differential inference attacks, exposing system state changes without proper authorization.  
*   **Problematic State(s):**  
    *   `S18`: Performed **user2|remote|DeviceControl**, received **CLS_3 (Failed: "device reset")**, transitioned to **State S18**, causing **leakage of device reinitialization status**.  
    *   `S5`: Performed **QR scan operation**, received **error code (e.g., -2010/-2011)**, transitioned to **not specified**, causing **distinction between authentication failure types**.  
    *   `S6`: Performed **QR scan operation**, received **error code (e.g., -2010/-2011)**, transitioned to **not specified**, causing **distinction between authentication failure types**.  
    *   `S8`: Performed **QR scan operation**, received **error code (e.g., -2010/-2011)**, transitioned to **not specified**, causing **distinction between authentication failure types**.