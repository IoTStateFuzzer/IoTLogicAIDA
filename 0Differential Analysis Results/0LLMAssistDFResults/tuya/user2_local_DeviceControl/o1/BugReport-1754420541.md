# BTB Semantic
```json
{
    "local_user1_AddDevice": null,
    "local_user1_DeviceControl": [
        [
            "Operation result: Undetermined. Evidence: '**3 short MQTT packets with no error or success codes**'; '**no success or error trace in generic MQTT packets**'; '**no explicit success/failure in MQTT packets**'; '**multiple MQTT packets with no error or termination**'; '**multiple MQTT messages with no explicit success/error**'. Reason: The majority indicates no explicit success or final confirmation in MQTT traffic, while a minority viewpoint highlights a sustained exchange without negative signals."
        ]
    ],
    "local_user1_RemoveDevice": [
        [
            "Operation result: Success. Evidence: . Reason: The reset call references indicated a successful device removal"
        ]
    ],
    "local_user1_SharePlug": [
        [
            "Operation result: Failed. Evidence: 'errorCode=REPETITION_SHARE'. Reason: Majority consensus indicates the attempt was unsuccessful due to repeated share error. A minority viewpoint suggests the device was already shared to user2."
        ],
        [
            "Operation result: Success. Evidence: 'success=true'. Reason: The request was processed successfully and the device is confirmed shared."
        ]
    ],
    "local_user1_UnsharePlug": [
        [
            "Operation result: Success. Evidence: '/api.json/smartlife/m/sharing/device/remove' with 'result':true. Reason: The remove endpoint returned 'result':true confirming device unshare success."
        ]
    ],
    "local_user2_DeviceControl": [
        [
            "Operation result: Undetermined. Evidence: 'single TCP packet'. Reason: A lone packet without clear success or error signals leaves the outcome inconclusive."
        ],
        [
            "Operation result: Success. Evidence: 'MQTT'. Reason: Ongoing exchange with no failure indicators demonstrates a successful operation."
        ]
    ],
    "remote_user2_DeviceControl": [
        [
            "Operation result: Success. Evidence: ''. Reason: Sustained multi-packet MQTT exchange with no negative signals indicates normal completion."
        ],
        [
            "Operation result: Undetermined. Evidence: ''. Reason: Only a single MQTT transmission observed, providing insufficient detail to confirm success or failure."
        ]
    ]
}
```

# State Semantic
## Base model
| State | Semantic Description                                                                                                           |
|-------|-------------------------------------------------------------------------------------------------------------------------------|
| 0     | Initial state.                                                                                                                |
| 1     | user1 has added the device once; user2 is not invited and has no permissions.                                                 |
| 2     | Error state.                                                                                                                  |
| 3     | user1 has added the device once and shared it with user2 via direct device sharing; user2 automatically has control over this device. |

## Divergent model
| State | Semantic Description |
|-------|----------------------|
| 0 | Initial state. |
| 1 | user1 has added the device for the first time; user2 is not invited and has no permissions. |
| 2 | Error state. |
| 3 | user1 has one device added and directly shared it with user2, granting user2 automatic control. |
| 4 | user1 has the device added and shared; user2 is actively controlling it. |
| 5 | user1 revokes direct sharing from user2, removing user2’s control permission. |
| 6 | user1 removes the device, invalidating user2’s direct-share permission. |
| 7 | user1 re-adds the device (second instance); user2 has no permission on this new device. |
| 8 | user1 shares the re-added device with user2, granting user2 direct control permission again. |

# Bug Reports
## Base model
*   No issues found.

## Divergent model
*   **Vulnerability 1: Unauthorized Device Control After Permission Revocation**  
    *   **Impact:** User2 can continue to operate the device even after User1 revokes direct-sharing permission, violating User1’s intent and compromising integrity and availability. This also breaks the principle that a user without valid sharing or family-member status must be denied control operations.  
    *   **Problematic State(s):**  
        *   `s5`: Performed “user2|local|DeviceControl / Symbol: CLS_1,” received “Success,” remained in “s5,” causing User2 to retain and exercise control despite the revoked permission.

*   **Vulnerability 2: Differential Inference of Device Re-Addition**  
    *   **Impact:** By comparing the results of the same “user2|local|DeviceControl” request in different states (s6 vs. s7), User2 can infer that the device has been re-added. The change in response codes (“NoResponse” → “Undetermined”) reveals otherwise hidden lifecycle information.  
    *   **Problematic State(s):**  
        *   `s6`: Performed “user2|local|DeviceControl / Symbol: CLS_NoResponse,” received “Failed,” remained in “s6,” causing User2 to observe no device response.  
        *   `s7`: Performed “user2|local|DeviceControl / Symbol: CLS_0,” received “Undetermined,” remained in “s7,” causing User2 to deduce the device was re-added (differential response leak).