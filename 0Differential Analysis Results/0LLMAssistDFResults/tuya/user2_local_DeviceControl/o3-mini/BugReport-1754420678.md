# BTB Semantic
```json
{
    "local_user1_AddDevice": null,
    "local_user1_DeviceControl": [
        [
            "Operation result: Success. Evidence: '0x00000040'. Reason: The use of sequential control codes culminating in the final packet indicator '0x00000040' demonstrates a completed device control exchange, which is reinforced by the consistent presence of this code across the majority of the examined packets despite the presence of less explicit patterns in other entries."
        ]
    ],
    "local_user1_RemoveDevice": [
        [
            "Operation result: Success. Evidence: 'type':'del'. Reason: The MQTT payload presents a deletion indicator ('type':'del') confirming a successful RemoveDevice operation, with one source further supported by an HTTP POST response ('success':true,'status':'ok') that reinforces the successful outcome."
        ]
    ],
    "local_user1_SharePlug": [
        [
            "Operation result: Failed. Evidence: '**'REPETITION_SHARE'**'. Reason: The sharing device account add packet returned error codes and messages that consistently reference 'REPETITION_SHARE', indicating that the device had already been shared and the operation failed."
        ],
        [
            "Operation result: Success. Evidence: '**'receiverName':'user2'**'. Reason: The packet consistently returned success with a valid receiver entry, confirmed by the shared evidence of receiver 'user2', which objectively supports a successful sharing operation."
        ]
    ],
    "local_user1_UnsharePlug": [
        [
            "Operation result: Success. Evidence: ''result':true'. Reason: The unshare API consistently returned a payload featuring the raw fragment 'result':true, confirming that the removal request succeeded."
        ]
    ],
    "local_user2_DeviceControl": [
        [
            "Operation result: Undetermined. Evidence: 'device_0'. Reason: The evidence consists exclusively of device_0 header details without any accompanying user2 context, indicating that the packets do not fulfill the criteria for a decisive DeviceControl operation."
        ],
        [
            "Operation result: Success. Evidence: 'user2_local'. Reason: The evidence reflects sustained, bidirectional traffic with user2_local identifiers across MQTT and TCP, which is fully consistent with the expected behavior of a successful DeviceControl operation."
        ]
    ],
    "remote_user2_DeviceControl": [
        [
            "Operation result: Success. Evidence: 'FPSPERAbs_Len1'. Reason: The recurring appearance of 'FPSPERAbs_Len1' indicates the expected minimal-length acknowledgment that signals normal completion of the DeviceControl command, aligning with the majority consensus despite isolated reports with alternate minimal payload descriptions."
        ],
        [
            "Operation result: Undetermined. Evidence: 'FPSPERAbs_Len1'. Reason: While the 'FPSPERAbs_Len1' fragment is consistently observed, its presence alongside isolated minimal payload indicators without clear status codes yields an inconclusive DeviceControl operation outcome."
        ]
    ]
}
```

# State Semantic
## Base model
| State | Semantic Description |
|-------|----------------------|
| s0    | Initial state. |
| s1    | user1 added the device instance once with no sharing action performed; user2 does not hold any control permissions. |
| s2    | Error state. |
| s3    | user1 added the device instance once and then executed a direct sharing action (via SharePlug), granting user2 control rights limited to this specific device instance. |

## Divergent model
| State | Semantic Description |
|-------|----------------------|
| s0 | Initial state: no device has been added and no sharing action has occurred; user2 holds no permissions. |
| s1 | user1 has added the device for the first time (device instance count = 1) without initiating any sharing; user2 does not have control permission. |
| s2 | Error state. |
| s3 | user1 added the device (instance count = 1) and initiated a direct sharing invitation (via SharePlug); user2 is automatically granted direct control permission, although no control action has been executed yet. |
| s4 | user1 added and shared the device (first instance) and user2 exercised control, confirming active direct control permission for that shared device instance. |
| s5 | After user2 obtained direct control permission, user1 revoked sharing (via UnsharePlug) while retaining the device instance, thereby rescinding user2’s permission. |
| s6 | user1 removed the shared device instance, which revokes user2’s direct control permission as the device is no longer active. |
| s7 | user1 removed the device and then re-added it—resulting in a new device instance (device addition count incremented) without reinitiating sharing; consequently, user2 does not hold control permission on the new instance. |
| s8 | user1 re-added the device and re-initiated direct sharing (via SharePlug) on the new instance; as a result, user2 is automatically granted direct control permission for that instance. |

# Bug Reports
## Base model
*   No issues found.

## Divergent model
*   **Vulnerability 1: Unauthorized DeviceControl Operation After Revocation**
    *   **Impact:** In state s5, once user1 revokes sharing via the UnsharePlug action, the system erroneously continues to allow a DeviceControl operation (user2|local|DeviceControl, Symbol: CLS_1) to succeed. Despite the intended removal of control rights, user2’s operation receives a Success response, which violates authorization rules. This flaw undermines the confidentiality and integrity of the system by enabling an attacker or malicious user2 to control the device even after permission should have been rescinded.
    *   **Problematic State(s):**
        *   `s5`: After user1 executes UnsharePlug to revoke sharing, user2 performs a DeviceControl operation that returns a Success response (Symbol: CLS_1), thereby allowing unauthorized control of the device.
        
*   **Vulnerability 2: Differential Response Leading to Potential Information Leakage**
    *   **Impact:** In contrast to the clear violation in state s5, state s7 exhibits an ambiguous outcome with an “Undetermined” response when a related operation is attempted. Although this result does not immediately enable unauthorized control, the inconsistency between states (Success in s5 vs. Undetermined in s7) may allow an attacker to infer sensitive internal state details. Such differential behavior could be exploited to perform further targeted attacks based on the leaked state information.
    *   **Problematic State(s):**
        *   `s7`: The operation in this state results in an “Undetermined” outcome, creating ambiguity in permission enforcement and potentially exposing internal state details to an attacker.