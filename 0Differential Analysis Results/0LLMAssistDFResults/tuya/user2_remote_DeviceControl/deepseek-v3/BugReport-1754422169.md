# BTB Semantic
```json
{
    "local_user1_AddDevice": null,
    "local_user1_DeviceControl": [
        [
            "Operation result: Undetermined. Evidence: 'mqtt' traffic patterns; 'smart/mb/in/208580022462ab36ab23'. Reason: Consistent MQTT traffic patterns detected with device-specific routing (smart/mb/in/208580022462ab36ab23), but payload analysis shows no explicit success/failure indicators. Majority consensus confirms insufficient evidence for status determination."
        ]
    ],
    "local_user1_RemoveDevice": null,
    "local_user1_SharePlug": [
        [
            "Operation result: Failed. Evidence: ''success':false,'errorCode':'REPETITION_SHARE''. Reason: Consistent error code indicates device was already shared with the user"
        ],
        [
            "Operation result: Success. Evidence: ''success':true,'result':{'receiverName':'user2'}'. Reason: Payload confirms successful device sharing with user2"
        ]
    ],
    "local_user1_UnsharePlug": [
        [
            "Operation result: Success. Evidence: '/api.json/smartlife/m/sharing/device/remove|||||FPSPER{'result':true,'t':|-----------|,'success':true,'status':'ok'}'. Reason: Consistent success confirmation across all reports with HTTP 200 response, explicit 'result:true', 'success:true', and 'status:ok' in device removal operation."
        ]
    ],
    "local_user2_DeviceControl": [
        [
            "Operation result: Undetermined. Evidence: 'Abs_Len2|UAbs_Len12|w3.3Abs_Len115|U'; 'device_0||tcp||||||0x00000018|135|FPSPERAbs_Len2|UAbs_Len12|w3.3Abs_Len115|U'. Reason: No decisive payload evidence or clear traffic pattern for DeviceControl operation, with consistent observation of ambiguous length patterns and TCP session metadata."
        ],
        [
            "Operation result: Success. Evidence: 'smart/mb/in/208580022462ab36ab23'; 'user2_local||mqtt||||0x00000030|smart/mb/in/208580022462ab36ab23|||FPSPER2.2Abs_Len124|'. Reason: MQTT control channel established with device-specific topic pattern (smart/mb/in/208580022462ab36ab23) and sustained flow characteristics, confirmed across multiple observations with protocol-specific metadata."
        ]
    ],
    "remote_user2_DeviceControl": [
        [
            "Operation result: Undetermined. Evidence: 'mqtt'; 'smart/mb/in/208580022462ab36ab23'. Reason: MQTT traffic detected with device-specific topic but lacks explicit success/failure indicators in payload (majority consensus). Minority evidence suggests possible success interpretation from sustained data flow."
        ],
        [
            "Operation result: Undetermined. Evidence: 'Abs_Len1'; 'No relevant payload'. Reason: Empty MQTT packets provide insufficient payload data for operation status determination (unanimous consensus)."
        ]
    ]
}
```

# State Semantic
## Base model
| State | Semantic Description |  
|-------|----------------------|  
| 0     | Initial state. |  
| 1     | user1 added the device; user2 has no permissions. |  
| 2     | Error state. |  
| 3     | user1 added the device and shared it with user2 via direct device sharing; user2 has temporary control permissions (valid only for this device instance until removal/re-addition). |

## Divergent model
| State | Semantic Description |
|-------|----------------------|
| S0    | Initial state. |
| S1    | user1 added the device; user2 has no permissions. |
| S2    | Error state. |
| S3    | user1 added the device and shared it with user2 via direct device sharing; user2 has permissions for this device instance. |
| S4    | user1 added and shared the device with user2; user2 attempted device control (status undetermined). |
| S5    | user1 added, shared, then unshared the device with user2; user2's permissions are revoked. |
| S6    | user1 added, shared, then removed the device; user2's permissions are revoked and device is no longer accessible. |

# Bug Reports
## Base model
* No issues found.

## Divergent model
* **Vulnerability 1: Persistent Control After Permission Revocation**
    * **Impact:** User2 retains the ability to attempt device control operations even after permissions have been revoked (in unshared state S5` and removed state `s6`), potentially leading to unauthorized access if the system fails to properly enforce permission checks. This behavior persists across multiple states, indicating a systemic issue with permission revocation enforcement. The system returns "Undetermined" responses (CLS_1) instead of explicit denials, which could mask security issues or enable blind attack persistence.
    * **Problematic State(s):**
        * `s5`: Performed **user2|remote|DeviceControl**, received **Undetermined response (CLS_1)**, transitioned to **State S5**, causing potential unauthorized control attempt after unsharing.
        * `s6`: Performed **user2|remote|DeviceControl**, received **Undetermined response (CLS_1)**, transitioned to **State S6**, causing potential unauthorized control attempt after device removal.

* **Vulnerability 2: Information Leakage via Differential Response**
    * **Impact:** The system provides different response symbols (CLS_0 vs. CLS_1) for the same operation (`user2|remote|DeviceControl`) across states (`s3`/`s4` vs. `s5`/`s6`), potentially allowing attackers to infer system state changes (e.g., whether permissions are still valid). This differential response behavior violates Principle 2 of information leakage and could be exploited to determine permission status without proper authorization.
    * **Problematic State(s):**
        * `s3`: Performed **user2|remote|DeviceControl**, received **Undetermined response (CLS_0)**, transitioned to **State S4**, potentially leaking state information through response differences.
        * `s4`: Performed **user2|remote|DeviceControl**, received **Undetermined response (CLS_0)**, maintaining **State S4**, showing inconsistent feedback with other states.
        * `s5`: Performed **user2|remote|DeviceControl**, received **Undetermined response (CLS_1)**, maintaining **State S5**, showing different response symbol than `s3`/`s4`.
        * `s6`: Performed **user2|remote|DeviceControl**, received **Undetermined response (CLS_1)**, maintaining **State S6**, showing same response as `s5` but different from `s3`/`s4`.

* **Vulnerability 3: Lack of Explicit Access Denial**
    * **Impact:** The system fails to explicitly deny unauthorized control attempts (e.g., with error codes) in `s5`/`s6`, instead returning ambiguous "undetermined" responses (CLS_1). This lack of clear failure responses could allow attackers to exploit timing or side channels and may enable blind attack persistence. The ambiguity in responses obscures permission validity and fails to clearly enforce authorization boundaries.
    * **Problematic State(s):**
        * `s5`: Performed **user2|remote|DeviceControl**, received **Undetermined response (CLS_1)**, transitioned to **State S5**, failing to clearly enforce permission revocation.
        * `s6`: Performed **user2|remote|DeviceControl**, received **Undetermined response (CLS_1)**, transitioned to **State S6**, failing to clearly enforce permission revocation.
        * `s4`: Performed **user2|remote|DeviceControl**, received **Undetermined response (CLS_0)**, transitioned to **State S4**, obscuring permission validity.