# BTB Semantic
```json
{
    "local_user1_AddDevice": null,
    "local_user1_DeviceControl": [
        [
            "Operation result: Undetermined. Evidence: 'mqtt packets from user1_local with no explicit status code or success message'; 'no explicit success/error payload'; 'No explicit status/error codes or control responses'. Reason: The predominant evidence indicates a continued MQTT flow that lacks explicit success or failure status codes, and the repeated observation of missing explicit payloads supports an Undetermined verdict."
        ]
    ],
    "local_user1_RemoveDevice": [
        [
            "Operation result: Success. Evidence: **'type':'del'**. Reason: The evidence explicitly shows a deletion action ('type':'del') in the MQTT packet, confirming the RemoveDevice operation as indicated by the majority consensus across the reports."
        ]
    ],
    "local_user1_SharePlug": [
        [
            "Operation result: Failed. Evidence: 'REPETITION_SHARE'. Reason: The sharing/device/account/add packet returned error indicators that consistently include the duplicate share token 'REPETITION_SHARE', objectively confirming that the device had already been shared."
        ],
        [
            "Operation result: Success. Evidence: 'receiverName':'user2'. Reason: The sharing/device/account/add packet confirmed a successful share operation by returning receiver detail information with receiverName user2, objectively establishing a valid relation."
        ]
    ],
    "local_user1_UnsharePlug": [
        [
            "Operation result: Success. Evidence: ''result':true'. Reason: The packets consistently contain an explicit payload value of 'result':true confirming that the device removal operation (unshare) was successful, as evidenced by multiple packets addressing the /sharing/device/remove endpoint."
        ]
    ],
    "local_user2_DeviceControl": [
        [
            "Operation result: Undetermined. Evidence: 'device_0'. Reason: The repeated occurrence of a device_0 header\u2014without any matching user2_local context\u2014indicates that the packet evidence does not align with the operation\u2019s expected source, leading to an inconclusive verdict."
        ],
        [
            "Operation result: Success. Evidence: 'user2_local||mqtt'. Reason: The presence of sustained bidirectional communication, as evidenced by recurring user2_local and MQTT markers, confirms the DeviceControl operation was executed successfully."
        ]
    ],
    "remote_user2_DeviceControl": [
        [
            "Operation result: Success. Evidence: **'FPSPERAbs_Len1'**. Reason: The evidence shows a consistent minimal-length packet that functions as an acknowledgment in the DeviceControl protocol, supporting the outcome despite isolated ambiguity in some details."
        ],
        [
            "Operation result: Undetermined. Evidence: **'FPSPERAbs_Len1'**. Reason: The reports indicate that a solitary minimal payload packet does not provide sufficient bidirectional confirmation, resulting in an ambiguous control outcome even though a minority suggested success."
        ]
    ]
}
```

# State Semantic
## Base model
| State | Semantic Description |
|-------|----------------------|
| s0 | Initial state. |
| s1 | User1 added the device instance once with no sharing action performed, so user2 has no control permissions. |
| s2 | Error state. |
| s3 | User1 added the device instance (first addition) and then executed a direct sharing action (SharePlug), granting user2 control limited to that specific device instance (non-family sharing, with permissions revoked if the device is removed or re-added). |

## Divergent model
| State | Semantic Description |
|-------|----------------------|
| s0    | Initial state with no device operations performed (no device added and no sharing configured). |
| s1    | User1 adds a device instance (device addition count = 1); no sharing is initiated, so user2 has no control permission. |
| s2    | Error state. |
| s3    | User1 adds a device instance and initiates a direct sharing invitation, thereby granting user2 instance-limited control permission even though no remote control action has been taken. |
| s4    | User1’s device instance remains active and shared, and user2 remotely exercises control over that instance, confirming the instance-based permission. |
| s5    | User1 added and shared the device and user2 exercised control; subsequently, user1 revokes the sharing (via UnsharePlug), which withdraws user2’s control permission for that specific instance. |
| s6    | User1 added and shared the device and user2 exercised control, but then user1 removed the device, automatically revoking the direct sharing permission and ending user2’s control for that instance. |

# Bug Reports
## Base model
* No issues found.

## Divergent model
* **Vulnerability 1: Differential Inference from Ambiguous Remote Control Responses**
  * **Impact:** In certain divergent states, specifically s5 and s6, unauthorized remote DeviceControl attempts by user2 return responses that differ markedly from those provided when permissions are active. In authorized states (s3/s4), the control action yields a clear “Success” response; however, after sharing is revoked (s5 via UnsharePlug) or following device removal (s6), the system responds with an ambiguous “Undetermined” outcome accompanied by a minimal payload (e.g. evidence “FPSPERAbs_Len1”). This differential feedback can enable an attacker to deduce that the underlying permissions have changed—even though the operation is not executed—by observing the shift from explicit success to ambiguous rejection. While one analysis (Report 5) contends that these responses align with designed permission semantics and do not expose exploitable sensitive details, the recurring observations in multiple reports suggest that the differing nature of these responses could serve as a side channel for inferring device or sharing state changes, potentially paving the way for subsequent targeted attacks.
  * **Problematic State(s):**
    * `s5`: After revocation of sharing via UnsharePlug, user2’s remote DeviceControl returns an “Undetermined” result with minimal payload evidence (“FPSPERAbs_Len1”), contrasting with the clear success response seen when permissions are active.
    * `s6`: Following device removal—which implicitly revokes sharing—user2’s remote DeviceControl again yields an “Undetermined” outcome with the same minimal payload, allowing inference of the altered system state.